= LO hacking notes

== 2011-12-22

- cmdline to incrementally rebuild with debug:

----
make -sr dbglevel=2 -j4
----

- cmdline to get SAL_INFO / SAL_WARN output:

----
SAL_LOG=+INFO.writerfilter+WARN.writerfilter ./soffice.bin --nologo /home/vmiklos/git/libreoffice/lo-test-files/writer/bugs/fdo40937/Crashing.rtf 2>&1 |tee out
----

== 2011-12-28

typical konsole tabs:

- doc
- build
- hack
- run
- test
- push

onegit master build with empty ccache but ccache enabled on my t520:

----
real    93m35.371s
----

with full ccache:

----
real    26m24.653s
----

== 2012-01-01

Export filter -> exporter calls:

- doc: SwWW8Writer::WriteStorage
- docx: DocxExportFilter::exportDocument
- rtf: RtfExportFilter::filter

== 2012-01-11

Localized string howto: add the string to src/hrc, then:

----
#include <tools/resmgr.hxx>
#include <vcl/svapp.hxx>
... include of the hrc ...

static ResMgr* pResMgr = ResMgr::CreateResMgr("module", Application::GetSettings().GetUILocale());
OUString sFooBar(ResId::toString(ResId(RID_MODULESTR_FOO_BAR, *pResMgr)));
----

== 2011-02-04

bibisect:

SAL_USE_VCLPLUGIN="gen" opt/program/soffice.bin

good: 65fd30f5cb4cdd37995a33420ed8273c0a29bf00
bad: 4c30602f43475389f81b1d981ce8ee9a3410b9d9

-> d5f5b9bb5dc47417fcd9cc494b8d2dcd4a7c620e first bad -> a57304a53832adf0c8a32b0c53d9be5b55507ab1 in core.git
-> d0ae9578f865b45dd01b822d5d6be45b5872f842 last good -> 97453f1eabb473d0691e41153eff2ac92e88a302 in core.git

== 2011-03-28

To run a single unit test in gdb:

----
GDBCPPUNITTRACE="gdb --args" make -sr /home/vmiklos/git/libreoffice/master/workdir/unxlngx6/CppunitTest/sw_ooxmlimport.test
----

== 2011-03-29

Installing all build-deps on openSUSE 12.2:

----
zypper si -d libreoffice
zypper in git doxygen ctags krb5-devel java-1_7_0-openjdk-devel
----

== 2011-04-03

Magic line to load http://bernard.marcelly.perso.sfr.fr/index2.html[xray] when it's already installed:

----
GlobalScope.BasicLibraries.LoadLibrary("XrayTool")
----

== 2011-04-04

- samples to insert set / get fields:

----
Sub insertSetField()
oDoc = ThisComponent 
oMasters = oDoc.TextFieldMasters
sMasterFieldName = "com.sun.star.text.FieldMaster.SetExpression.foo"
if oMasters.hasByName(sMasterFieldName) then
    oMaster = oMasters.getByName(sMasterFieldName)
else
    oMaster = oDoc.createInstance("com.sun.star.text.FieldMaster.SetExpression")
    oMaster.Name = "foo"
    oMaster.SubType = 3
end if
oField = oDoc.createInstance("com.sun.star.text.TextField.SetExpression") 
oField.Content = "bar"
oField.attachTextFieldMaster(oMaster)
oField.SubType = 3
oField.IsVisible = False
oText = oDoc.Text 
oCurs = oDoc.getCurrentController().getViewCursor()
oText.insertTextContent(oCurs, oField, False) 
End Sub

Sub insertGetField()
oDoc = ThisComponent 
oField = oDoc.createInstance("com.sun.star.text.TextField.GetExpression") 
oField.Content = "foo"
oField.SubType = 3
oText = oDoc.Text 
oCurs = oDoc.getCurrentController().getViewCursor()
oText.insertTextContent(oCurs, oField, False) 
End Sub
----

== 2012-05-05

Experimenting with gdb pretty-printers:

To run once:

----
gdb --args ./soffice.bin --nologo /home/vmiklos/git/libreoffice/master/sw/qa/extras/ooxmltok/data/n751017.docx
b DomainMapper_Impl.cxx:3093
print xFieldProperties
----

To reload without restart:

----
python import libreoffice.cppu
python p = libreoffice.cppu.BeansXPropertySetPrinter("com::sun::star::beans::XPropertySet", gdb.parse_and_eval("*xFieldProperties.get()")); print p.to_string()
python reload(libreoffice.cppu)
----

The XPropretySet pretty-printer is blocked by this: http://sourceware.org/bugzilla/show_bug.cgi?id=13326

== 2012-06-25

How to trigger SwXTextDefaults::supportsService() from basic:

----
o = ThisComponent.createInstance("com.sun.star.text.Defaults")
xray o.supportsService("com.sun.star.style.CharacterProperties")
----

== 2012-07-21

Simple Calc macro:

----
' Does the following transformation:
' A1: 11, B1: 11, A2: 11, B2: 11 -> A1: 11, B1: 12, A2: 13, B2: 14
' Works if starting point is not A1, or prefix is not "1"
contents = ThisComponent.CurrentSelection.String
contents = left(contents, len(contents)-1)
document   = ThisComponent.CurrentController.Frame
dispatcher = createUnoService("com.sun.star.frame.DispatchHelper")
dim args(0) as new com.sun.star.beans.PropertyValue
dispatcher.executeDispatch(document, ".uno:GoRight", "", 0, args())
ThisComponent.CurrentSelection.String = contents & "2"
dispatcher.executeDispatch(document, ".uno:GoLeft", "", 0, args())
dispatcher.executeDispatch(document, ".uno:GoDown", "", 0, args())
ThisComponent.CurrentSelection.String = contents & "3"
dispatcher.executeDispatch(document, ".uno:GoRight", "", 0, args())
ThisComponent.CurrentSelection.String = contents & "4"
dispatcher.executeDispatch(document, ".uno:GoLeft", "", 0, args())
dispatcher.executeDispatch(document, ".uno:GoUp", "", 0, args())
----

== 2012-11-23

- learned today:
  - single line spacing: 15%
  - utf8 can store more than utf16

== 2012-11-24:

- gdb tricks
  - "command" command
  - dmapper: print m_pImpl->m_xBodyText._pInterface->m_pImpl->m_pDoc->GetNodes()
  - rtftok: print m_rImport->m_pMapperStream->m_pImpl->m_xBodyText._pInterface->m_pImpl->m_pDoc->GetNodes()
  - rtf filter: print (*pStream)->m_pImpl->m_xBodyText._pInterface->m_pImpl->m_pDoc->GetNodes()
  - text range: print xTextRange._pInterface->m_pImpl->m_pMark->m_pPos1
  - cursors: print print *m_aTextAppendStack.top().xCursor._pInterface->m_pImpl->GetRegisteredIn()
  - soffice.bin: /home/vmiklos/git/libreoffice/master/sw/source/core/bastyp/index.cxx:236: virtual SwIndexReg::~SwIndexReg(): Assertion !m_pFirst && !m_pLast failed.

set logging on
b /home/vmiklos/git/libreoffice/master/sw/source/core/bastyp/index.cxx:34
b /home/vmiklos/git/libreoffice/master/sw/source/core/bastyp/index.cxx:43
b /home/vmiklos/git/libreoffice/master/sw/source/core/bastyp/index.cxx:53
command 1 2 3
print this
bt 5
c
end
set pagination off
r
frame 4
print m_pFirst
print m_pLast

- rtf speedup:

before:
./soffice.bin --nologo /home/vmiklos/git/libreoffice/lo-test-files/writer/bugs/fdo44736/lorem421pages_format_parag_and_text.rtf
debug, finished in 20686 ms

after:
debug, finished in 12021 ms

== 2012-11-25

- icecream client thing:

zypper -p http://download.opensuse.org/repositories/home:/llunak:/clang/openSUSE_12.2/ in icecream-0.9.7-64.1s.x86_64 # to be fair with others, and be a server as well
http://en.opensuse.org/Icecream#Firewall
CCACHE_PREFIX="icecc" make -sr -j30

- mso-dumper: Word can't open comment.rtf's cleaned up version, but Writer can ;)

== 2012-12-24

- fdo#57678: test.rtf.wordbug - next Word bug..

== 2013-02-18

- converting to Microsoft-style docx: ./soffice.bin --headless --convert-to docx:'MS Word 2007 XML'
- converting to odt: ./soffice.bin --headless --convert-to odt:writer8

== 2013-04-02

How to detect missing includes:

- GCC: use

----
make CPPFLAGS="-Wundef"
----

in a partial build.

- MSVC: insert

----
#pragma warning (default : 4668)
----

at the top of the file and recompile.

== 2013-06-27

Android notes:

- to run the emulator:

----
~/git/libreoffice/android/android-sdk-linux/tools$ LD_LIBRARY_PATH=$(pwd)/lib ./emulator-arm -avd myavd-lo -partition-size 500
----

- upload pkg:

----
~/git/libreoffice/android/android-sdk-linux/platform-tools/adb install master~2013-06-27_00.05.44_LibreOffice4Android-debug.apk
----

- current master seems to be broken at runtime, let's try with `master~2013-02-28_07.22.59_LibreOffice4Android-debug.apk` -> works!

- built e440724eb7febe0072d79683d1a6f3b586575a3f -> also works!

== 2013-07-14

- rendered page size in px:

----
I/DocumentLoader(  808): debug, width is 480, height is 762
----

- enable sdk controller:

----
~/git/libreoffice/android/android-sdk-linux/platform-tools/adb forward tcp:1970 localabstract:android.sdk.controller
----

== 2013-12-27

\clmgf is: cell merge group first
\clmrg: is cell merge resume group

API to merge cells:

oCursor = ThisComponent.TextTables(0).createCursorByCellName("A1")
oCursor.gotoCellByName("B1", True)
oCursor.mergeRange()

From position to cell name:
ThisComponent.TextTables(0).getCellByPosition(0, 0).CellName

== 2013-12-29

fdo#41109

dhgt: small -> further back
shpz: 0 -> back, N -> top

if they are conflicting, shpz has priority

== 2014-02-07

How to get only the stdout of a unit test:

----
make CppunitTest_sw_ooxmlexport gb_CppunitTest__interactive=t 2>/dev/null |tee out
grep -v File out > out2
sort -t ',' -nk 2 out2
----

== 2014-05-16

Update indented-files.txt for style-check-files:

----
~/git/vmexam/bash/git-ls-creators |tee creators-new.csv
mv creators-new.csv creators.csv
egrep "(cxx|hxx|py);.*$USER" creators.csv |sed 's/;.*//' > ~/indented-files-new
git diff --no-index indented-files.txt indended-files-new | grep ^+[^+] | grep -v sw/qa
----

== 2014-08-02

Detecting unused imports and variables with pylint:

----
for i in *.py; do pylint -r n $i; done > out
----

and then search for 'used'.

== 2014-10-04

How ODF import decides between editeng and a Writer TextFrame:

xmloff/source/text/XMLTextFrameContext.cxx, XMLTextFrameContext::XMLTextFrameContext()

== 2015-04-24

Clang AST dump:

clang++ -Xclang -ast-dump -fsyntax-only test.cc

https://kevinaboos.wordpress.com/2013/07/23/clang-tutorial-part-ii-libtooling-example/

== 2015-10-16

https://bugs.documentfoundation.org/show_bug.cgi?id=94374

Steps to reproduce on master, e.g.:

1) Create a hello-world docx file using Word.

2) Insert -> Object -> Document

3) Read error

== 2015-10-22

https://bugs.documentfoundation.org/show_bug.cgi?id=59454

RTF import: if section break is right before a table, it gets ignored.

DOCX import doesn't seem to be affected.

In writerfilter::dmapper::SectionPropertyMap::SetStart(), m_xStartingRange points to node #9, then node #10.

in docx, SectionPropertyMap::CloseSectionGroup start has the same values
in rtf, the second SectionPropertyMap::CloseSectionGroup has m_xStartingRange pointing to #18

2e8aad6d45c53d554ccaf26de998ede708cfc289 fixes a similar problem for docx

yes, 'ase NS_ooxml::LN_tblStart' of DomainMapper::sprmWithProps() is what makes docx work

so rtftok has to know where a table starts/ends -- could work it around with
start/end a table in RTF_ROW, but sounds ugly.

better approach seems to be to keep an eye on m_nCellxMax when it does a 0 -> n
or n -> 0 transition -> fixed.

== 2015-10-30

https://bugs.documentfoundation.org/show_bug.cgi?id=89088

last page is missing, gdb catch throw points out
ShapeContextHandler::endFastElement in
oox/source/shape/ShapeContextHandler.cxx, using >>= there fixes the bug.

https://gerrit.libreoffice.org/#/c/19676/

without patch: mem usage of android ODT after load according to top (RES): 254500, after typing 30 "8": 288168
with patch:                                                                257008, after typing 30 "8": 258064

== 2015-11-06

https://bugs.documentfoundation.org/show_bug.cgi?id=85232 -- a vml->dml regression wrt groupshape handling

- git:

related vml commit: 7877638814de86202d33b5653a0f91d63341e98c

- code:

related VML code: oox::vml::ShapeBase::convertAndInsert
related DML code: oox::drawingml::Shape::createAndInsert

- DML import works by setting the transformation matrix once, methods to tweak it:

basegfx::B2DHomMatrix::decompose to decompose
basegfx::tools::createScaleShearXRotateTranslateB2DHomMatrix to compose

- aha, root cause is missing mm100 -> twips conversion

== 2015-11-13

https://bugs.documentfoundation.org/show_bug.cgi?id=83300

a 4.1 -> 4.2 regression

== 2015-11-20

https://bugs.documentfoundation.org/show_bug.cgi?id=78902

a 4.2 -> 4.3 regression

created minimized test document: 2,2M -> 30K

bibisect-43all, last42onmaster is good, last43onmaster is bad (layout does not finish in about 10 sec)
- [4fcd68ce4979f85fda4568f4b419a4b41d07345f] source-hash-2c4621c87ed3a7b19de195c21494c9a381e72b2e is good
- [422186458e0b4db00c7e26b54d5b631f83bcad2a] source-hash-6948bf58ce181b17f60ef81f10205ef4dac50cc6 is skip
- [a0b33bffff9c787dce71a13b344f06ae1453026b] source-hash-02e0be069e57e724c51f23e2e31b77657a6a1d3d is bad
- [db29eee512d03b1dc0139b3752bbe7931b165377] source-hash-77b6c1602aaa0bd059077765e7fabb53d9e6ddeb is bad (hangs hard)
- [0b79394752f7ecbab6ab4ecedbfab8551c6e9fbd] source-hash-381613916d42a1e18e2824b5d41028dcfe19659a is bad
- [7c18060e3625d89e7ca6c3a75b0f609200150252] source-hash-2589d9e3e6e9fab18ff735561991a3dcdd3d8b4b is good
- [2f040759edbb7bb8e7a41cf06bac2a2a0fb50c73] source-hash-76fe205d7e0fe0a73616453209d8094cab9ce79f is good
- [a03a074d7d24b285022244e1939b1abbedc76d1e] source-hash-c84f0dae40b6f3e64a265efcc76b1757edbdbf45 is bad
- [56a3b3c781fc2eb55f46641d89a866a91119a8a3] source-hash-21e6fd2b2dfdb806db320f699e434e6f2351a7b6 is bad

56a3b3c781fc2eb55f46641d89a866a91119a8a3 / source-hash-21e6fd2b2dfdb806db320f699e434e6f2351a7b6 is the first bad
2f040759edbb7bb8e7a41cf06bac2a2a0fb50c73 / source-hash-76fe205d7e0fe0a73616453209d8094cab9ce79f is still good

nominally a regression from 2b78f2cd7b9e4bab0f3b3b9119238f36a1bbc7b2 (but obviously just made a previous problem visible)

idea: hack SwFrm::InsertPage() so that layout finishes (disable sw page frame deletions), then compare the ww8 and ooxml import results

binary doc import seems to create an sw image, while ooxml+vml import creates a draw image

== 2015-11-27

https://bugs.documentfoundation.org/show_bug.cgi?id=95865

4b918705f67d0837b56e56d7abac23e6eb21feb4 is supposed to be good -> indeed
41379970e8c6b75563b7c162b4e760b9e93a5bea is suppoesd to be bad -> indeed
bd2455d310b35d6e231627c1a89301450be0c65d is good
bf35ea1dea48cfc5617e116c1f638f787f349855 is bad
910c31ab55a90c87e9e16ded734fec396660e331 is bad
6adfbe62f6bb67d7d78c1561e9af5169d7f5bb9a is bad
5f87aafea491b111fa1d7518c746e0e1304a069a is good
147b74beea7b5f0fb121e5495bbdfb4869786603 is good
98785dbb95eca5443b38535cba6552e21d4e2c5b is good -> bisected

https://bugs.documentfoundation.org/show_bug.cgi?id=94043

ww8 import result:

SeparatorLineColor        long                          0   
SeparatorLineIsOn         boolean                    True   
SeparatorLineRelativeHeight long                      100   
SeparatorLineStyle        byte                          0   
SeparatorLineVerticalAlignment integer                  0   
SeparatorLineWidth        long                          2  

docx import result: SeparatorLineWidth is 0

testcase:
ThisComponent.TextSections.Section1.TextColumns.SeparatorLineWidth

=== 2015-12-04

https://bugs.documentfoundation.org/show_bug.cgi?id=94377

RtfAttributeOutput::PostitField just writes plain text
DocxAttributeOutput::WritePostitFields seems to do better

=== 2015-12-11

https://bugs.documentfoundation.org/show_bug.cgi?id=96113

Similar fix: 79fb61efb847405fa47235002b52ee8efad5e339

testcase: ThisComponent.DrawPage(0).BackColor should be 0x00FF00

=== 2015-12-18

https://bugs.documentfoundation.org/show_bug.cgi?id=93009

025952f52767fb3508a6725468fe4b1e6ce4c9b1 is supposed to be good: indeed
a6f5770b4aaaa6506a22eae0d641ad48f9b6d239 is supposed to be bad: indeed
cfde943f59b0cf63c46cbe061fd37e53201d2363 is bad
978033d5ed9f93f2d5d9a1ba44acf6b37bc13bfe is bad
f1256611054701a2bba20225fb654814eecbf559 is good
b5a4e6974a5473c44fc239b6a9ae21f233111c2a is good

978033d5ed9f93f2d5d9a1ba44acf6b37bc13bfe is the problem

=== 2015-12-22

https://bugs.documentfoundation.org/show_bug.cgi?id=96674

VML import has similar tweaks in ShapeType::getAbsRectangle() and
ShapeType::getRelRectangle().

=== 2015-12-29

https://bugs.documentfoundation.org/show_bug.cgi?id=95213

testcase:

oParas = ThisComponent.Text.createEnumeration
oPara = oParas.nextElement
oPara = oParas.nextElement
xray oPara.NumberingRules.getByIndex(1) ' ListLabel 4 and ListLabel 5 for CharStyleName

=== 2015-12-30

https://bugs.documentfoundation.org/show_bug.cgi?id=96308

probably a regression from b9c1a9b9aa41dbbb6bed0c77f4370ab6105c7fb1

two problems: incorrect tab stop + tab stop is not deleted

def tab stop should be 0.5cm, is 1.27cm

tab stop not deleted: sort of already handled in writerfilter::dmapper::DomainMapper::sprmWithProps(), but only for the case when there is still at least one tab stop kept

testcase -- get cell text: xray ThisComponent.TextTables(0).getCellByName("B1").Text

=== 2016-01-08

https://bugs.documentfoundation.org/show_bug.cgi?id=92613 -- no idea how to reproduce this

Raal says 5.0 is bad, 5.1 is good

https://bugs.documentfoundation.org/show_bug.cgi?id=93374 is a duplicate and can reproduce steps using daily-till51.git:
- oldest is bad
- c5625a3e1014766a488ca42e986be5dd3efbf051 is good
- [a8d19eafb9e195a85359dd8cdc5c46c38295caa0] 2015-08-22: source-hash-79fb61efb847405fa47235002b52ee8efad5e339 is bad (good for g-b)
- [2ad98b12d82c4ada5756881f0d6074154976e95c] 2015-10-08: source-hash-2e6feddc53830406fa04b4a0aea49bb8438dc702 is good (bad for g-b)
- [508476d55906e21bc6c15423a8730d9d3a9f6cc8] 2015-09-14: source-hash-41007842ed9bb5d6165792a197769f72dae55a2c is bad (good for g-b)
- [a0c244a6d24022e88db2a8b4db2e06ec62b08b49] 2015-09-26: source-hash-18c196f0190d9920673cdd9a4dbc158f08959cfd is bad (good for g-b)
- [9b3e246c95933293fa60b1e377bf05b0e1c80a6d] 2015-10-02: source-hash-419549b095a1bb95ce23bf3fc8866e6b582e6dde is bad (good for g-b)
- [08a963f5804d7847a6bba2961a15779e8bc06a39] 2015-10-05: source-hash-c9c61e0faab31c753f60361a2909c1e61481ac89 is bad (good for g-b)
- [868763b62a54e99514cbf4a697363bf1e1f9f497] 2015-10-07: source-hash-f830600ece806ec365a4839e79afabe183c5e36d is good (bad for g-b)
- [16676509e5ca93d0acbb20998fa8586870330095] 2015-10-06: source-hash-3e5b53438d7001fde1b4664b8867be3dcfae4b95 is good (bad for g-b)
=> 16676509e5ca93d0acbb20998fa8586870330095 / 2015-10-06: source-hash-3e5b53438d7001fde1b4664b8867be3dcfae4b95 is the first good -> indeed
=> 08a963f5804d7847a6bba2961a15779e8bc06a39 / 2015-10-05: source-hash-c9c61e0faab31c753f60361a2909c1e61481ac89 is the last bad -> indeed
range is c9c61e0faab31c753f60361a2909c1e61481ac89..3e5b53438d7001fde1b4664b8867be3dcfae4b95

fixed by 92fd894ea18672cba4cf961bdc4c0bc98f168102, tdf#94435

=== 2016-01-22

https://bugs.documentfoundation.org/show_bug.cgi?id=95376

bugdoc: paragraph has:
        <w:pStyle w:val="TGCabnumberedpara"/>
and
          <w:ilvl w:val="0"/>
          <w:numId w:val="6"/>
para style has:
        <w:numId w:val="8"/>
      <w:ind w:left="340" w:firstLine="0"/>
numbering has:
        <w:ind w:left="3318" w:hanging="340"/>
-> Word ignores w:firstLine for some reason?

regression from tdf#92454, where:

bugdoc paragraph has:
        <w:pStyle w:val="Heading2"/>
para style has:
        <w:numId w:val="8"/>
      <w:ind w:left="0" w:firstLine="0"/>
numbering has:
        <w:ind w:left="4330" w:hanging="360"/>

-> sounds like a direct ind-from-num > ind-from-parastyle, but
                        ind-from-parastyle > ind-from-num-from-parastyle

=== 2016-01-28

- could .uno:Paste take an AnchorType param, so pasted image could be anchored e.g. as-char, not at-para?

related commit: e7eca35148204d094dcdb7d8b3e4ec6c9d454159, SwWrtShell::Insert()
SID_PASTE in sfx2/sdi/sfx.sdi, doesn't seem to take a param
1dc60bc9e99304c58007bfd5a964ff3f78480106 added a new param to an uno command, in sfx2/sdi/sfxitems.sdi

dim args1(0) as new com.sun.star.beans.PropertyValue
args1(0).Name = "Text"
args1(0).Value = "s"
dispatcher.executeDispatch(document, ".uno:InsertText", "", 0, args1())

SfxVoidItem SplitCell FN_TABLE_SPLIT_CELLS
(SfxInt32Item Amount FN_TABLE_SPLIT_CELLS,SfxBoolItem Horizontal FN_PARAM_1,
 SfxBoolItem Proportional FN_PARAM_2)

SfxUInt16Item seems to be used to pass enums, e.g. FN_INSERT_DBFIELD's FN_PARAM_FIELD_TYPE
RndStdIds is the same as text::TextContentAnchorType -> implemented

- https://bugs.documentfoundation.org/show_bug.cgi?id=97371

good:
<sdrObject ptr="0x2608360" symbol="17SdrObjCustomShape" name="&#x81EA;&#x9009;&#x56FE;&#x5F62; 11" title="" description="" nOrdNum="0" aOutRect="14270, 3950, 690, 411"/>
<sdrObject ptr="0x2615880" symbol="16SwVirtFlyDrawObj" name="" title="" description="" nOrdNum="1" aOutRect="14270, 3951, 690, 375"/>

bad:
<sdrObject ptr="0x2d97610" symbol="17SdrObjCustomShape" name="&#x81EA;&#x9009;&#x56FE;&#x5F62; 11" title="" description="" nOrdNum="0" aOutRect="14270, 410, 690, 411"/>
<sdrObject ptr="0x2d191a0" symbol="16SwVirtFlyDrawObj" name="" title="" description="" nOrdNum="1" aOutRect="14270, 3951, 690, 375"/>

=== 2016-01-29

- https://bugs.documentfoundation.org/show_bug.cgi?id=96175

turns out this is not the avg. custom property, rtf has a dedicated \company

- davido's "how to test docx export validation failing" question:

ooxmlexport2 has a whitelist, NoFillAttrInImagedata.docx is a doc that would fail otherwise

    cd sw; make -sr CppunitTest_sw_ooxmlexport2 CPPUNIT_TEST_NAME="NoFillAttrInImagedata"

html export numbering notes for Marc

rtf export code coverage:
- RtfExport::WriteRevTab is untested

oParas = ThisComponent.Text.createEnumeration
oPara = oParas.nextElement
oPara = oParas.nextElement
oRuns = oPara.createEnumeration
oRun = oRuns.nextElement
oRun = oRuns.nextElement
'xray oRun.TextPortionType
xray oRun.RedlineAuthor

=== 2016-02-12

https://bugs.documentfoundation.org/show_bug.cgi?id=59699

first goal: make it work for docx

oox::core::FilterBase::getAbsoluteUrl(): mxImpl->maFileUrl is empty!

code flow:
- writerfilter::ooxml::OOXMLFastContextHandlerShape::OOXMLFastContextHandlerShape
- oox::shape::ShapeContextHandler::setInputStream
- oox::core::FilterBase::setMediaDescriptor

test: xray ThisComponent.DrawPage(0).Graphic -> null object

=== 2016-02-19

Still fighting <https://bugs.documentfoundation.org/show_bug.cgi?id=59699>, the
DOCX equivalent is working, now back to the original RTF problem.

'includepicture "libreoffice.png" \d '

UI: 'AUTHOR  \* Upper '

aMediaDesc.getUnpackedValueOrDefault("InsertMode", false)

failed tests:

rtfimport.cxx:858:Assertion
Test name: testCopyPasteFootnote::Import
equality assertion failed
- Expected: bbb
- Actual  : bbb

rtfimport.cxx:2307:Assertion
Test name: testTdf90260Nopar::Import
equality assertion failed
- Expected: 1
- Actual  : 2

=== 2016-03-04

----
oChart = ThisComponent.getEmbeddedObjects.getByName("myChart")
oChartComponent = oChart.Component
oDataSequences = oChartComponent.DataSequences
oChart.ExtendedControlOverEmbeddedObject.changeState(1)
oDataSequences(2).Values.setModified(true)
----

----
REM  *****  BASIC  *****
option explicit

Sub ChartModifier
	dim oDoc as variant: odoc = thisComponent.CurrentController
	dim oChart as variant: oChart = oDoc.Model.getEmbeddedObjects.getByName("myChart")
        dim oChartComponent as variant: oChartComponent = oChart.Component
	dim oDataSequences as variant: oDataSequences = oChartComponent.DataSequences
	dim oInternalDataProvider as variant: oInternalDataProvider = oChartComponent.DataProvider
	dim aData as variant: aData = oInternalDataProvider.Data: rem a sequence of x|y pairs
	dim nLoData as integer: nLoData = LBound(aData)
	dim nUoData as integer: nUoData = UBound(aData)	
	dim aPair(0 to 1) as double
	dim index as integer
	dim fX as double
	dim fY as double
	for index = nLoData to nUoData
		aPair = aData(index)
	    fX = aPair(0)
	    fY = fX+10*rnd()
	    aPair(1) = fY
	    aData(index)  = aPair
	next index
    oInternalDataProvider.data = aData
    oChart.ExtendedControlOverEmbeddedObject.changeState(1)
    oDataSequences(2).Values.setModified(true)
End Sub
----

=== 2016-03-11

https://bugs.documentfoundation.org/show_bug.cgi?id=98458

idea: add a "SearchItem.SearchInShapes" (disabled by default)
how to add a new option? 1dc60bc9

SwView::SearchAndWrap -> m_pSrchItem

=== 2016-03-18

https://bugs.documentfoundation.org/show_bug.cgi?id=65642

      <w:pgNumType w:fmt="upperLetter" w:start="1"/>

PROP_PAGE_NUMBER_OFFSET
page style's prop: NumberingType is 9 -> CHARS_UPPER_LETTER_N

                <DomainMapper.sprm name="ooxml:EG_SectPrContents_pgNumType">(ooxml:EG_SectPrContents_pgNumType, OOXMLPropertySetValue(t:0x21d1160, m:0x229e970))
                  <tablemanager.sprm>(ooxml:EG_SectPrContents_pgNumType, OOXMLPropertySetValue(t:0x21d1160, m:0x229e970))</tablemanager.sprm>
                  <TablePropertiesHandler.sprm sprm="(ooxml:EG_SectPrContents_pgNumType, OOXMLPropertySetValue(t:0x21d1160, m:0x229e970))"/>
                  <unhandled/>
                  <DomainMapper.attribute name="ooxml:CT_PageNumber_fmt" value="92259"/>
                  <DomainMapper.attribute name="ooxml:CT_PageNumber_start" value="1"/>
                </DomainMapper.sprm>
                <DomainMapper.sprm name="ooxml:EG_SectPrContents_cols">(ooxml:EG_SectPrContents_cols, OOXMLPropertySetValue(t:0x21d1410, m:0x21a1760))
                  <tablemanager.sprm>(ooxml:EG_SectPrContents_cols, OOXMLPropertySetValue(t:0x21d1410, m:0x21a1760))</tablemanager.sprm>
                  <TablePropertiesHandler.sprm sprm="(ooxml:EG_SectPrContents_cols, OOXMLPropertySetValue(t:0x21d1410, m:0x21a1760))"/>
                  <unhandled/>
                  <SectionColumnHandler.attribute name="ooxml:CT_Columns_space" value="708"/>
                </DomainMapper.sprm>

testcase:

oPageStyle = ThisComponent.StyleFamilies.PageStyles.getByName("Converted1")
'xray oPageStyle.NumberingType '9

oParas = ThisComponent.Text.createEnumeration
oPara = oParas.nextElement
oPara = oParas.nextElement
xray oPara.PageNumberOffset ' 1

=== 2016-03-25

https://bugs.documentfoundation.org/show_bug.cgi?id=98806

testcase:

xray ThisComponent.Bookmarks.bookmark.anchor.String ' BBB
xray ThisComponent.Bookmarks.getByName("bookmark").getAnchor().getString() ' BBB

=== 2016-04-01

https://bugs.documentfoundation.org/show_bug.cgi?id=84695

testcase idea: enter, a -> assert text
GetKeyCode().GetCode() == KEY_RETURN
char code 0

=== 2016-04-08

https://bugs.documentfoundation.org/show_bug.cgi?id=99135

odt has: clip="rect(0cm, 0cm, 1.826cm, 0cm)" and svg:height="1.455cm" -> GraphicCrop.Bottom should be 1826

docx has: cropbottom="36468f" which is on a 0..65536 scale, so 0.556 (and height:41.25pt), so ideally bottom crop is 22.95387 points

SwCropGrf, binary filter does this in SwWW8ImplReader::SetAttributesAtGrfNode, pGrfNd->GetTwipSize() gives the orig size internally

looks like GraphicCrop is a common api with draw shapes, good
ww8 values in twips:
debug:27674:1: SwWW8ImplReader::SetAttributesAtGrfNode: height is 1860 (mm100: 3280), crop from bottom is 36468, result is 1035 (mm100: 1825)
-> ThisComponent.DrawPage(0).Graphic.Size100thMM.Height gives good value (real property)

=== 2016-04-23

https://bugs.documentfoundation.org/show_bug.cgi?id=90097

testcase:

2nd child, bad:
6337, 1619; 6699, 1962
2nd child, good:
6337, 1963; 6699, 1620

=== 2016-04-29

https://bugs.documentfoundation.org/show_bug.cgi?id=95707

https://en.wikipedia.org/wiki/BMP_file_format#File_structure

GraphicFilter::ImportGraphic, vcl/source/filter/graphicfilter.cxx:1315
-> GraphicFilter::ImpTestOrFindFormat
-> ImpPeekGraphicFormat() returns false
it wants the size at offset 14 -> tweaked, now we detect the thing as BMP
next: import itself still fails
-> ReadDIBBitmapEx()
-> ImplReadDIBFileHeader()
-> ImplReadDIBBody()
-> ImplReadDIBInfoHeader()

testcase:
good case: GraphicURL is vnd.sun.star.GraphicObject:10000000000000C80000001D5756BDC1A6CBC66D
bad case: vnd.sun.star.GraphicObject:0000000000000000000000000000000000000000

=== 2016-05-06

https://bugs.documentfoundation.org/show_bug.cgi?id=96275

yet another "buffering text, but something is imported directly" situation

testcase:

oTable = ThisComponent.Text.createEnumeration.nextElement
oParas = oTable.getCellByName("A1").createEnumeration
oPara = oParas.nextElement
oPara = oParas.nextElement
oPara = oParas.nextElement
oRuns = oPara.createEnumeration
oRun = oRuns.nextElement
xray oRun.TextPortionType ' should be Frame

=== 2016-05-13

https://bugs.documentfoundation.org/show_bug.cgi?id=78357

seems to be an RTF import problem. good on master, bad with 4.2
4.3 is bad
4.4 is good
bibisect-44max.git:
- oldest is bad
- master is good

https://bugs.documentfoundation.org/show_bug.cgi?id=82073

clcbpatraw is not handled

=== 2016-05-20

https://bugs.documentfoundation.org/show_bug.cgi?id=74795

- trpaddl not imported
- docx has <w:left w:w="360" w:type="dxa"/> -> ooxml:CT_TblCellMar_left

testcase:

oParas = ThisComponent.Text.createEnumeration
oTable = oParas.nextElement
xray oTable.getCellByName("A1").LeftBorderDistance ' should be 635
xray oTable.getCellByName("A2").LeftBorderDistance ' should be 0

=== 2016-05-27

https://bugs.documentfoundation.org/show_bug.cgi?id=77349

DOCX import creates draw images, so not affected
DOC import has this correctly, as SwReader::Read() calls SwDoc::SetAllUniqueFlyNames()
writerfilter::dmapper::GraphicImport_Impl::applyName

=== 2016-06-03

https://bugs.documentfoundation.org/show_bug.cgi?id=50821

width type is ignored, as it should be an attr, not an sprm

testcase:

oParas = ThisComponent.Text.createEnumeration
oTable = oParas.nextElement
oTable = oParas.nextElement
xray oTable.getCellByName("A1").LeftBorderDistance ' should be 191, was 0

=== 2016-06-10

https://bugs.documentfoundation.org/show_bug.cgi?id=60375

can reproduce comment 2 with lo42
lo43: everything is fine

can bibisect? daily-till43:
- master is bad

daily-till44:
- master is good
- oldest is bad
- [364ba817b97ce3b1d9ce53a2b51235cdb82d6864] 2014-08-21 is good (bad for g-b)
- [479f8e7126777715c2ce39bb89483b88696f747e] 2014-07-05 is good (bad for g-b)
- [10b4496584ecc392a40239e3f3c7ee455d83bfb4] 2014-06-12 is bad (good for g-b)
- [9489aec63676d47ec9aacfe2b165b601479013f6] 2014-06-23 is good (bad for g-b)
- [35c0f684cef2fdbe270ff9d3b37169731ef61033] 2014-06-17 is good (bad for g-b)
- [ccc4bae0e9ca921992b4a53a1b8ea70a0609be76] 2014-06-14 is good (bad for g-b)
- [75fffefc44f42439b85484865ea2bf601953d7d1] 2014-06-13 is bad (good for g-b)
=> ccc4bae0e9ca921992b4a53a1b8ea70a0609be76 / 2014-06-14 is the first good -> b8979cae28cc541a1cfca1b4d2f79b92308bcda0 in core.git
=> 75fffefc44f42439b85484865ea2bf601953d7d1 / 2014-06-13 is the last  bad  -> fd8cee8c1fb34432b786d54651f33b6c961ca7fe in core.git

https://bugs.documentfoundation.org/show_bug.cgi?id=91684

after ungroup, the orange shape is 2.54 x 2.54cm, should be 0.69x0.67cm
relRight = 11634, relLeft = 10194, rel width is 1440 -- probably we count this in twips, but this is just a relative value

related code is writerfilter::rtftok::RTFSdrImport::resolve()

that solves the scaling, but what about the flip?

orange rect:
{\sp
{\sn fRelFlipH}
{\sv 1}
}
{\sp
{\sn fRelFlipV}
{\sv 0}
}

parent:

{\sp
{\sn fFlipH}
{\sv 1}
}
{\sp
{\sn fFlipV}
{\sv 1}
}

at least here the fRelFlip* is irrelevant

=== 2016-06-17

https://bugs.documentfoundation.org/show_bug.cgi?id=100352

SvxAutoCorrectLanguageLists::LoadAutocorrWordList: sShareAutoCorrFile already contains hu-HU

LANGUAGE_HUNGARIAN

SvxAutoCorrect::GetAutoCorrFileName creates hu-HU from LanguageTag, i.e. const LanguageTag& rLanguageTag,
    OUString sRet, sExt( rLanguageTag.getBcp47() );
Application::GetSettings().GetLanguageTag()

=== 2016-07-07

Trying to fix up <https://gerrit.libreoffice.org/#/c/24403/> -- upgrade xmlsec to 1.2.21

Failure happens locally in a CentOS7 chroot.

Problematic test is SigningTest::testDescription. Fails with running just that single test:

make -sr CppunitTest_xmlsecurity_signing CPPUNIT_TEST_NAME="SigningTest::testDescription"

Last LO frame is XMLSignature_NssImpl::generate().

Does the output of 'print xmlDebugDumpNode(stderr, pNode, 1)' differ in the good/bad case?

Not really, the key part is the same. It seems
xmlSecNssKeyDataX509VerifyAndExtractKey() is called in the bad case, but not in
the good one. Does parallel debugging help?

bad bt:

#0  0x00007fffcc810018 in xmlSecNssKeyDataX509VerifyAndExtractKey (data=0x16d3180, key=0x16d2fe0, keyInfoCtx=0x16d2b80) at x509.c:1346
#1  0x00007fffcc80c136 in xmlSecNssKeyDataX509XmlRead (id=0x7fffccabc2e0 <xmlSecNssKeyDataX509Klass>, key=0x16d2fe0, node=0x16d0e70, keyInfoCtx=0x16d2b80) at x509.c:715
#2  0x00007fffcc836d24 in xmlSecKeyDataXmlRead (id=0x7fffccabc2e0 <xmlSecNssKeyDataX509Klass>, key=0x16d2fe0, node=0x16d0e70, keyInfoCtx=0x16d2b80) at keysdata.c:308
#3  0x00007fffcc82ea85 in xmlSecKeyInfoNodeRead (keyInfoNode=0x16d0bf0, key=0x16d2fe0, keyInfoCtx=0x16d2b80) at keyinfo.c:112
#4  0x00007fffcc835f5d in xmlSecKeysMngrGetKey (keyInfoNode=0x16d0bf0, keyInfoCtx=0x16d2b80) at keys.c:1347
#5  0x00007fffcc84e008 in xmlSecDSigCtxProcessKeyInfoNode (dsigCtx=0x16d2b70, node=0x16d0bf0) at xmldsig.c:943
#6  0x00007fffcc84cc81 in xmlSecDSigCtxProcessSignatureNode (dsigCtx=0x16d2b70, node=0x16c9ac0) at xmldsig.c:581
#7  0x00007fffcc84bfd9 in xmlSecDSigCtxSign (dsigCtx=0x16d2b70, tmpl=0x16c9ac0) at xmldsig.c:321

good case:
xmlSecDSigCtxSign is called
xmlSecDSigCtxProcessSignatureNode is called
xmlSecDSigCtxProcessSignatureNode fails when it calls xmlSecDSigCtxProcessSignedInfoNode(), so xmlSecDSigCtxProcessKeyInfoNode() is not called

bad case: xmlSecDSigCtxProcessSignedInfoNode() does not fail

So, how does xmlSecDSigCtxProcessSignedInfoNode() fail in the good case?

warn:xmlsecurity.xmlsec:428:1:xmlsecurity/source/xmlsec/errorcallback.cxx:43: parser.c:182: xmlSecParserPushBin() 'xml-parser' 'xmlParseChunk' 5 'size=64'
warn:xmlsecurity.xmlsec:428:1:xmlsecurity/source/xmlsec/errorcallback.cxx:43: transforms.c:1676: xmlSecTransformPump() 'xml-parser' 'xmlSecTransformPushBin' 1 ' '
warn:xmlsecurity.xmlsec:428:1:xmlsecurity/source/xmlsec/errorcallback.cxx:43: transforms.c:1199: xmlSecTransformCtxUriExecute() '' 'xmlSecTransformPump' 1 'uri=Thumbnails/thumbnail.png'
warn:xmlsecurity.xmlsec:428:1:xmlsecurity/source/xmlsec/errorcallback.cxx:43: transforms.c:1319: xmlSecTransformCtxExecute() '' 'xmlSecTransformCtxUriExecute' 1 ' '
warn:xmlsecurity.xmlsec:428:1:xmlsecurity/source/xmlsec/errorcallback.cxx:43: xmldsig.c:1571: xmlSecDSigReferenceCtxProcessNode() '' 'xmlSecTransformCtxExecute' 1 ' '
warn:xmlsecurity.xmlsec:428:1:xmlsecurity/source/xmlsec/errorcallback.cxx:43: xmldsig.c:804: xmlSecDSigCtxProcessSignedInfoNode() '' 'xmlSecDSigReferenceCtxProcessNode' 1 'node=Reference'

The 4th call to xmlSecDSigReferenceCtxProcessNode() fails, as that's Thumbnails/thumbnail.png.

8f6c95a90735c4d6e13bddf84de7a5284132826c in xmlsec.git is the problematic commit, it kind of removed an early return when png was feeded as XML -> that's it

=== 2016-07-15

https://bugs.documentfoundation.org/show_bug.cgi?id=61901

last35onmaster: font on 3rd line in Word after LO roundtrip is not liberation (nominally good)
last36onmaster: it's times new roman (nominally bad)

=== 2016-07-22

https://bugs.documentfoundation.org/show_bug.cgi?id=95967

daily-till51.git:
- oldest is bad
- master^ is good
- [a8d19eafb9e195a85359dd8cdc5c46c38295caa0] 2015-08-22: source-hash-79fb61efb847405fa47235002b52ee8efad5e339 is good (bad for g-b)
- [c9abefa2facd9d5f2989bbc2138e55970e60c4cd] 2015-07-06: source-hash-64385c7555c6bbb089f3ab8b2a5b623cadd6ee7d is good (bad for g-b)
- [d3328123e5e86a74111ff9f1fcdd742973bd3c80] 2015-06-12: source-hash-bb9dad2ef23829b2500c9f99154bca6a8ba7d49a is bad (good for g-b)
- [57aaa0c171166a76dcd09e7092f5ae111d4b5ccb] 2015-06-24: source-hash-2135fe0cef7bcf7160719f1f29ad65f2b064984b is good (bad for g-b)
- [e48eb783142c667bfdad999f0edb90f8253b0b65] 2015-06-18: source-hash-fb6dd2a73074b9695bd8ddf7ba40f1819b03024e is good (bad for g-b)
- [b0072876f11895701d29fdd527193dfecff72a8d] 2015-06-15: source-hash-46564fd97308ce070248482ad65a311a329a2b76 is bad (good for g-b)
- [ea66e33d42004c5689162daabde2f6feef90bf8a] 2015-06-17: source-hash-ffc1ffed11dc63a69fc2db04f12b3ea266b580fe is good (bad for g-b)
- [34b2392f075552fecb6d070eb506df3d20b86dcc] 2015-06-16: source-hash-80ec99db4325a439a8a3f1d420d0a80f8bf9c439 is good (bad for g-b) -> first good
- range is 46564fd97308ce070248482ad65a311a329a2b76..80ec99db4325a439a8a3f1d420d0a80f8bf9c439 -> d0bedaf9eface97d17787931457f3ffc89ac4216 -> tdf#84832

=== 2016-08-04

https://bugs.documentfoundation.org/show_bug.cgi?id=98396

Word doesn't seem to support this, a possible workaround is
<http://superuser.com/questions/368337/keep-all-the-rows-of-an-microsoft-word-2010-on-the-same-page>.

Works for me on master; reported version is 5.1.4

- works with 5.2? yes
- works with 5.1? no

daily-till52.git:
- master is good
- 968156e2cc954d47d7ed9b35a0d114a43cc9637e (oldest's first child) is bad -> can do a reverse bisect
- [9fdf4ea6419aee1fdfeb559f39f1fa9fc4b32448] 2016-02-25: source-hash-6851e977f71075c2f43b967a52dc1d035a75b0f2 is good (bad for g-b)
- [a7c76c323e8a895b7a5b89af9efce5990b82132c] 2016-01-10: source-hash-33208c347182d8fe80bfbe34fe3e0b4b21a0a7a2 is good (bad for g-b)
- [58eca217dd8f7eb12d5556eafc324fd296823301] 2015-12-18: source-hash-42645fe67cac22e9a96bc4b34c4f85c09185d9d2 is good (bad for g-b)
- [4a3d4b936a309598fd04ea8122fb15b82f1c48c1] 2015-12-07: source-hash-2cd9ecd8644d16780443cdb6b52e208af9066105 is bad (good for g-b)
- [25cfd733b857192061159070e7bc710570553ec9] 2015-12-12: source-hash-37d735b27477cc1b72063b0ef307a437fa5233a1 is bad (good for g-b)
- [39ea4b3644d7f6c74e24260099de307fb4f6b221] 2015-12-15: source-hash-e0d2acfa65d81da323cbe91e6451fca70e00bdd5 is good (bad for g-b)
- [9711326ba927faf119b83a68b79d40e1c264970b] 2015-12-14: source-hash-63feac2a3264ead8f52148644b14078a4be5a2b9 is bad (good for g-b)
=> 39ea4b3644d7f6c74e24260099de307fb4f6b221 / 2015-12-15: source-hash-e0d2acfa65d81da323cbe91e6451fca70e00bdd5 is the first good? indeed
=> 9711326ba927faf119b83a68b79d40e1c264970b / 2015-12-14: source-hash-63feac2a3264ead8f52148644b14078a4be5a2b9 is the last bad? indeed
=> core.git range is 63feac2a3264ead8f52148644b14078a4be5a2b9..e0d2acfa65d81da323cbe91e6451fca70e00bdd5 -> 4ec0cc0781312d908a46dca382fae8e416753756 was the fix

=== 2016-08-10

https://bugs.documentfoundation.org/show_bug.cgi?id=100507

bibisect-43all.git:
- last40onmaster is good
- last41onmaster is good
- last42onmaster is good
- last43onmaster is good

bibisect-44max.git:
- oldest is good
- master is bad

=== 2016-09-02

https://bugs.documentfoundation.org/show_bug.cgi?id=44986

the rtf equivalent of w:gridAfter is \trwWidthA

how to emulate it in the rtf tokenizer:

- fake \cellx after the last \cellx
- fake \cell after the last \cell

RTF_CLBRDRT, RTF_CLBRDRL, RTF_CLBRDRB, RTF_CLBRDRR, RTF_BRDRW

=== 2016-09-07

https://bugs.documentfoundation.org/show_bug.cgi?id=78727

Problem seems to be specific to shape with text anchored inside a floating
table.

Is the shape lost during SwXText::convertToTable()?

----
#0  0x00007ffff161a2f1 in SdrObjCustomShape::~SdrObjCustomShape() (this=0x5120480, __in_chrg=<optimized out>) at /home/vmiklos/git/libreoffice/master/svx/source/svdraw/svdoashp.cxx:847
#1  0x00007ffff161a35c in SdrObjCustomShape::~SdrObjCustomShape() (this=0x5120480, __in_chrg=<optimized out>) at /home/vmiklos/git/libreoffice/master/svx/source/svdraw/svdoashp.cxx:848
#2  0x00007ffff162b088 in SdrObject::Free(SdrObject*&) (_rpObject=@0x7fffffff6568: 0x0) at /home/vmiklos/git/libreoffice/master/svx/source/svdraw/svdobj.cxx:394
#3  0x00007fffce3b925f in SwDrawContact::~SwDrawContact() (this=0x51206c0, __in_chrg=<optimized out>) at /home/vmiklos/git/libreoffice/master/sw/source/core/draw/dcontact.cxx:623
#4  0x00007fffce3b92c6 in SwDrawContact::~SwDrawContact() (this=0x51206c0, __in_chrg=<optimized out>) at /home/vmiklos/git/libreoffice/master/sw/source/core/draw/dcontact.cxx:625
#5  0x00007fffce4c4ab4 in SwDrawFrameFormat::~SwDrawFrameFormat() (this=0x50a3130, __in_chrg=<optimized out>) at /home/vmiklos/git/libreoffice/master/sw/source/core/layout/atrfrm.cxx:3335
#6  0x00007fffce4c4b06 in SwDrawFrameFormat::~SwDrawFrameFormat() (this=0x50a3130, __in_chrg=<optimized out>) at /home/vmiklos/git/libreoffice/master/sw/source/core/layout/atrfrm.cxx:3336
#7  0x00007fffce18c60d in SwDoc::DelFrameFormat(SwFrameFormat*, bool) (this=0x1e08aa0, pFormat=0x50a3130, bBroadcast=false)
    at /home/vmiklos/git/libreoffice/master/sw/source/core/doc/docfmt.cxx:739
#8  0x00007fffce296c36 in sw::DocumentLayoutManager::DelLayoutFormat(SwFrameFormat*) (this=0x1e10030, pFormat=0x50a3130)
    at /home/vmiklos/git/libreoffice/master/sw/source/core/doc/DocumentLayoutManager.cxx:322
#9  0x00007fffce170d0b in DelFlyInRange(SwNodeIndex const&, SwNodeIndex const&) (rMkNdIdx=SwNodeIndex (node 5), rPtNdIdx=SwNodeIndex (node 22))
    at /home/vmiklos/git/libreoffice/master/sw/source/core/doc/docedt.cxx:227
#10 0x00007fffce170c5f in DelFlyInRange(SwNodeIndex const&, SwNodeIndex const&) (rMkNdIdx=SwNodeIndex (node 28), rPtNdIdx=SwNodeIndex (node 43))
    at /home/vmiklos/git/libreoffice/master/sw/source/core/doc/docedt.cxx:219
#11 0x00007fffce26134f in sw::DocumentContentOperationsManager::DeleteRangeImplImpl(SwPaM&) (this=0x1e10ca0, rPam=SwPaM = {...})
    at /home/vmiklos/git/libreoffice/master/sw/source/core/doc/DocumentContentOperationsManager.cxx:3711
#12 0x00007fffce260dc4 in sw::DocumentContentOperationsManager::DeleteRangeImpl(SwPaM&, bool) (this=0x1e10ca0, rPam=SwPaM = {...})
    at /home/vmiklos/git/libreoffice/master/sw/source/core/doc/DocumentContentOperationsManager.cxx:3628
#13 0x00007fffce260cf0 in sw::DocumentContentOperationsManager::DeleteAndJoinImpl(SwPaM&, bool) (this=0x1e10ca0, rPam=SwPaM = {...}, bForceJoinNext=false)
    at /home/vmiklos/git/libreoffice/master/sw/source/core/doc/DocumentContentOperationsManager.cxx:3608
#14 0x00007fffce252b76 in (anonymous namespace)::lcl_DoWithBreaks(sw::DocumentContentOperationsManager&, SwPaM&, bool (sw::DocumentContentOperationsManager::*)(sw::DocumentContentOperationsManager* const, SwPaM&, bool), bool) (rDocumentContentOperations=..., rPam=SwPaM = {...}, pFunc=
    (bool (sw::DocumentContentOperationsManager::*)(sw::DocumentContentOperationsManager * const, SwPaM &, bool)) 0x7fffce260ca2 <sw::DocumentContentOperationsManager::DeleteAndJoinImpl(SwPaM&, bool)>, bForceJoinNext=false) at /home/vmiklos/git/libreoffice/master/sw/source/core/doc/DocumentContentOperationsManager.cxx:512
#15 0x00007fffce258fac in sw::DocumentContentOperationsManager::DeleteAndJoin(SwPaM&, bool) (this=0x1e10ca0, rPam=SwPaM = {...}, bForceJoinNext=false)
    at /home/vmiklos/git/libreoffice/master/sw/source/core/doc/DocumentContentOperationsManager.cxx:1913
#16 0x00007fffce1b7936 in SwDoc::MakeFlyAndMove(SwPaM const&, SfxItemSet const&, SwSelBoxes const*, SwFrameFormat*) (this=0x1e08aa0, rPam=SwPaM = {...}, rSet=
    SfxItemSet of pool 0x1e06890 with parent 0x1e10d38 and Which ranges: [(87, 129), (150, 150), (1014, 1033), (10023, 10023)] = {...}, pSelBoxes=0x0, pParent=0x0)
    at /home/vmiklos/git/libreoffice/master/sw/source/core/doc/doclay.cxx:454
#17 0x00007fffce8823ca in SwXFrame::attachToRange(com::sun::star::uno::Reference<com::sun::star::text::XTextRange> const&) (this=0x51282d8, xTextRange=
    uno::Reference to (SwXTextRange *) 0x5123548) at /home/vmiklos/git/libreoffice/master/sw/source/core/unocore/unoframe.cxx:2805
#18 0x00007fffce884278 in SwXFrame::attach(com::sun::star::uno::Reference<com::sun::star::text::XTextRange> const&) (this=0x51282d8, xTextRange=uno::Reference to (SwXTextRange *) 0x5123548) at /home/vmiklos/git/libreoffice/master/sw/source/core/unocore/unoframe.cxx:3070
#19 0x00007fffce886136 in SwXTextFrame::attach(com::sun::star::uno::Reference<com::sun::star::text::XTextRange> const&) (this=0x5128230, xTextRange=uno::Reference to (SwXTextRange *) 0x5123548) at /home/vmiklos/git/libreoffice/master/sw/source/core/unocore/unoframe.cxx:3314
#20 0x00007fffce9cd4b3 in SwXText::convertToTextFrame(com::sun::star::uno::Reference<com::sun::star::text::XTextRange> const&, com::sun::star::uno::Reference<com::sun::star::text::XTextRange> const&, com::sun::star::uno::Sequence<com::sun::star::beans::PropertyValue> const&) (this=0x1fcf448, xStart=uno::Reference to (SwXTextRange *) 0x515a178, xEnd=uno::Reference to (SwXTextRange *) 0x5159808, rFrameProperties=uno::Sequence of length 20 = {...}) at /home/vmiklos/git/libreoffice/master/sw/source/core/unocore/unotext.cxx:1692
----

'SdrObjCustomShape::~SdrObjCustomShape' is is called by some delete code, but then where do we create a copy first?

----
#0  0x00007ffff161a290 in SdrObjCustomShape::SdrObjCustomShape() (this=0x52f9ac0) at /home/vmiklos/git/libreoffice/master/svx/source/svdraw/svdoashp.cxx:840
#1  0x00007ffff1636d52 in SdrObjFactory::MakeNewObject(unsigned int, unsigned short, SdrPage*, SdrModel*) (nInvent=1917081171, nIdent=33, pPage=0x0, pModel=0x0)
    at /home/vmiklos/git/libreoffice/master/svx/source/svdraw/svdobj.cxx:3151
#2  0x00007ffff1627b09 in SdrObject::CloneHelper<SdrObjCustomShape>() const (this=0x511e930) at /home/vmiklos/git/libreoffice/master/include/svx/svdobj.hxx:1018
#3  0x00007ffff1623774 in SdrObjCustomShape::Clone() const (this=0x511e930) at /home/vmiklos/git/libreoffice/master/svx/source/svdraw/svdoashp.cxx:2799
#4  0x00007fffce1b62a7 in SwDoc::CloneSdrObj(SdrObject const&, bool, bool) (this=0x1e095c0, rObj=..., bMoveWithinDoc=true, bInsInPage=true)
    at /home/vmiklos/git/libreoffice/master/sw/source/core/doc/doclay.cxx:130
#5  0x00007fffce2976bd in sw::DocumentLayoutManager::CopyLayoutFormat(SwFrameFormat const&, SwFormatAnchor const&, bool, bool) (this=0x1e13f30, rSource=..., 
    rNewAnchor=..., bSetTextFlyAtt=false, bMakeFrames=true) at /home/vmiklos/git/libreoffice/master/sw/source/core/doc/DocumentLayoutManager.cxx:457
#6  0x00007fffce25ffce in sw::DocumentContentOperationsManager::CopyFlyInFlyImpl(SwNodeRange const&, int, SwNodeIndex const&, bool) const (this=0x1e131a0, rRg=..., nEndContentIndex=0, rStartIdx=SwNodeIndex (node 6), bCopyFlyAtFly=false) at /home/vmiklos/git/libreoffice/master/sw/source/core/doc/DocumentContentOperationsManager.cxx:3455

^ probably should handle textbox here

#7  0x00007fffce25f0fd in sw::DocumentContentOperationsManager::CopyWithFlyInFly(SwNodeRange const&, int, SwNodeIndex const&, std::pair<SwPaM const&, SwPosition const&> const*, bool, bool, bool) const (this=0x1e131a0, rRg=..., nEndContentIndex=0, rInsPos=SwNodeIndex (node 21), pCopiedPaM=0x7fffffff6a20, bMakeNewFrames=true, bDelRedlines=false, bCopyFlyAtFly=false)
    at /home/vmiklos/git/libreoffice/master/sw/source/core/doc/DocumentContentOperationsManager.cxx:3205

^ not really, by the time this returns, we have 5 formats as expected

#8  0x00007fffce2645e0 in sw::DocumentContentOperationsManager::CopyImpl(SwPaM&, SwPosition&, bool, bool, SwPaM*) const (this=0x1e131a0, 
    rPam=SwPaM = {...}, rPos=SwPosition (node 21, offset 0), bMakeNewFrames=true, bCopyAll=false, pCpyRange=0x0)
    at /home/vmiklos/git/libreoffice/master/sw/source/core/doc/DocumentContentOperationsManager.cxx:4457
#9  0x00007fffce257c68 in sw::DocumentContentOperationsManager::CopyRange(SwPaM&, SwPosition&, bool, bool) const (this=0x1e131a0, rPam=SwPaM = {...}, rPos=SwPosition (node 21, offset 0), bCopyAll=false, bCheckPos=false) at /home/vmiklos/git/libreoffice/master/sw/source/core/doc/DocumentContentOperationsManager.cxx:1655
#10 0x00007fffce1b785c in SwDoc::MakeFlyAndMove(SwPaM const&, SfxItemSet const&, SwSelBoxes const*, SwFrameFormat*) (this=0x1e095c0, rPam=SwPaM = {...}, rSet=
    SfxItemSet of pool 0x1e00500 with parent 0x1e13fb8 and Which ranges: [(87, 129), (150, 150), (1014, 1033), (10023, 10023)] = {...}, pSelBoxes=0x0, pParent=0x0)
    at /home/vmiklos/git/libreoffice/master/sw/source/core/doc/doclay.cxx:442
#11 0x00007fffce882462 in SwXFrame::attachToRange(com::sun::star::uno::Reference<com::sun::star::text::XTextRange> const&) (this=0x52e2db8, xTextRange=
    uno::Reference to (SwXTextRange *) 0x52e6c58) at /home/vmiklos/git/libreoffice/master/sw/source/core/unocore/unoframe.cxx:2805
#12 0x00007fffce884310 in SwXFrame::attach(com::sun::star::uno::Reference<com::sun::star::text::XTextRange> const&) (this=0x52e2db8, xTextRange=uno::Reference to (SwXTextRange *) 0x52e6c58) at /home/vmiklos/git/libreoffice/master/sw/source/core/unocore/unoframe.cxx:3070
----

bad case:

debug:29277:1: DocumentContentOperationsManager::CopyFlyInFlyImpl: n is 0, bAdd is 1
debug:29277:1: DocumentContentOperationsManager::CopyFlyInFlyImpl: n is 1, bAdd is 1
debug:29277:1: DocumentContentOperationsManager::CopyFlyInFlyImpl: calling CopyLayoutFormat()
debug:29277:1: DocumentContentOperationsManager::CopyFlyInFlyImpl: calling CopyLayoutFormat()
debug:29277:1: DelFlyInRange: delete
debug:29277:1: DelFlyInRange: delete
debug:29277:1: DelFlyInRange: delete
debug:29277:1: DelFlyInRange: delete

why does DelFlyInRange() calls delete 4 times?
DelFlyInRange start: only 2 objects at the start, already

In SwDoc::MakeFlyAndMove(), this happens:
- first CopyRange() copies the frame formats, then
- DeleteAndJoin() removes the old ones

what is deleted?

----
(gdb) print rTmp
$26 = SwPaM = {point = SwPosition (node 34, offset 0), mark = SwPosition (node 49, offset 0)}
----

so:
- 37 -> delete
- 12 -> don't delete -- but it deletes all 4! -> fixed

=== 2016-09-10

AutoCheckEnabled in extensions/source/update

officecfg::Office::Common::Filter::Microsoft::Import::WinWordToWriter::get()

"/org.openoffice.Office.Common/Filter/Microsoft/Import/WinWordToWriter" -> comphelper::ConfigurationProperty

::get() does, where path is the above:

        css::uno::Any a(detail::ConfigurationWrapper::get(context).getPropertyValue(T::path()));
        return detail::Convert< U >::fromAny(a);

get -> getPropertyValue
isReadOnly -> isReadOnly

comphelper::detail::ConfigurationWrapper is used in the lower layer

css::configuration::XReadWriteAccess ->

        (access_->getPropertyByHierarchicalName(path).Attributes
         & css::beans::PropertyAttribute::READONLY)
        != 0;

css::configuration::ReadWriteAccess::create(context, "*");

tdf#101976 LibreOffice crashes when user tries to change read-only Online Update setting

=== 2016-09-16

https://bugs.documentfoundation.org/show_bug.cgi?id=84684

ZOrder of child shapes is not OK, it seems
Rectangle 1 has dhgt=251659264
Pie 2 has dhgt=251659264 -> same!

=== 2016-09-23

https://bugs.documentfoundation.org/show_bug.cgi?id=87914

UNO property is CharCaseMap with value com::sun::star::style::CaseMap::SMALLCAPS / 4 -> SVX_CASEMAP_KAPITAELCHEN / RES_CHRATR_CASEMAP

need to add: .uno:SmallCaps -> FN_SET_SMALL_CAPS

icon: lc_changecasetoupper.png -> 12px height

=== 2016-09-30

https://bugs.documentfoundation.org/show_bug.cgi?id=102360

2013-12-04 is when the problematic commit was pushed, 4.2 -> 4.3 regression, hash is 798a563db133ebed3876c245459d90ef54ee7c9a

1fd781e7cd33f325ec7e467ecd49e0cb6ff4762b is the cleanup commit

19abfaffe74b925e4428943d14187a7008797982 is the pptx commit (2014-03-14)

bad:
style:text-position="0% 100%"

good:
style:text-position="0% 58%"

problem is that CharEscapementHeight is now 100 even in Impress, while it should be 58

SdImportTest::testN862510_1 now fails

----
tdf#102360 PPTX import: set CharEscapementHeight unconditionally again

CharEscapementHeight was in practice always set in the drawingML import
before commit 798a563db133ebed3876c245459d90ef54ee7c9a (drawingml
import: don't set CharEscapementHeight unconditionally, 2013-12-04),
after that it was only set when there was a set baseline.
----

=> doesn't seem to be a regression after all

https://bugs.documentfoundation.org/show_bug.cgi?id=100830

ThisComponent.DrawPage(0).FillTransparence = 50

=== 2016-10-14

https://bugs.documentfoundation.org/show_bug.cgi?id=95031

auto spacing should be 0 inside numbering?

seems so, ww8 import has this in SwWW8ImplReader::AppendTextNode()

=== 2016-11-04

https://bugs.documentfoundation.org/show_bug.cgi?id=79329

- TableManager::resolveCurrentTable() is called 2 times with nRows>0 as expected, good
- the second table's C1 cell is the problem, there the startCell() call throws:

----
#1  0x00007fffcd9cce95 in SwXParagraph::getString() (this=0x36d2bf0) at /home/vmiklos/git/libreoffice/master/sw/source/core/unocore/unoparagraph.cxx:1386
#2  0x00007fffca1311d1 in writerfilter::dmapper::XTextRangeToString(com::sun::star::uno::Reference<com::sun::star::text::XTextRange> const&) (textRange=uno::Reference to (SwXParagraph *) 0x36d2c68) at /home/vmiklos/git/libreoffice/master/writerfilter/source/dmapper/util.cxx:38
#3  0x00007fffca02dc77 in writerfilter::dmapper::DomainMapperTableHandler::startCell(com::sun::star::uno::Reference<com::sun::star::text::XTextRange> const&, std::shared_ptr<writerfilter::dmapper::TablePropertyMap> const&) (this=0x20fff60, start=uno::Reference to (SwXParagraph *) 0x36d2c68, pProps=std::shared_ptr (count 3, weak 0) 0x36c69d0)
    at /home/vmiklos/git/libreoffice/master/writerfilter/source/dmapper/DomainMapperTableHandler.cxx:1186
#4  0x00007fffca113419 in writerfilter::dmapper::TableManager::resolveCurrentTable() (this=0x20fe860)
----

- the problem is specific to the case when the anchored floattable is at the cell start

before conversion:

----
BigPtrArray of length 19 = {
[   0] 0x1f22d00            StartNode , 
[   1] 0x1f1cbf0              EndNode , 
[   2] 0x1f23f20            StartNode , 
[   3] 0x1f1b5d0              EndNode , 
[   4] 0x1f21ee0            StartNode , 
[   5] 0x1f1b260              EndNode , 
[   6] 0x1f24ae0            StartNode , 
[   7] 0x1f22570              EndNode , 
[   8] 0x1f2afd0            StartNode , 
[   9]  0x1f549b0            TextNode "", 
[  10]  0x36d3b00            TextNode "A1", 
[  11]  0x36bae20            TextNode "B1", 
[  12]  0x21bfb80            TextNode "A1'", 
[  13]  0x36d35b0            TextNode "B1'", 
[  14]  0x21c0ed0            TextNode "C1'", 
[  15]  0x217fa30            TextNode "D1'", 
[  16]  0x217f4d0            TextNode "C1", 
[  17]  0x2181310            TextNode "", 
[  18] 0x1f23b20              EndNode }
----

after conversion:

----
[  24] 0x1f2afd0            StartNode , 
[  25]  0x1f549b0            TextNode "", 
[  26]  0x36d3b00            TextNode "A1", 
[  27]  0x36bae20            TextNode "B1", 
[  28]  0x217f4d0            TextNode "C1", 
[  29]  0x2181310            TextNode "", 
[  30] 0x1f23b20              EndNode }
----

- tried to replace the cell start/end XTextRange with XTextCursor, no joy, the C1 start still gets invalidated after the text frame conversion

=== 2016-11-18

https://bugs.documentfoundation.org/show_bug.cgi?id=103982

<wp:anchor dist*> attributes can't have negative values? yup, spec is clear on that

so why do we end up with negative values there? e.g. distB="-260350"

it's 0 + there is shadow.

MSO vml -> dml conversion result:

<wp:anchor distT="0" distB="0" distL="114300" distR="114300" ...>

our result:

<wp:anchor behindDoc="0" distT="0" distB="-260350" distL="114300" distR="-146050" ...>

=== 2016-11-25

https://bugs.documentfoundation.org/show_bug.cgi?id=104115

- bugreport claims that this is introduced by a5a836d8c43dc9cebbbf8af39bf0142de603a7c6, but checking with bibisect-50max I can't confirm that
- my bisect result:

----
6102f070a0d9a0a066af3da7d00030aaad29df0a is the first bad commit
commit 6102f070a0d9a0a066af3da7d00030aaad29df0a
Author: Matthew Francis <mjay.francis@gmail.com>
Date:   Wed May 27 17:55:56 2015 +0800

    source-hash-6b084f0001fc15112bf3c40d20a0c7096c83b7fe
    
    commit 6b084f0001fc15112bf3c40d20a0c7096c83b7fe
    Author:     Caolán McNamara <caolanm@redhat.com>
    AuthorDate: Thu Jan 8 20:58:24 2015 +0000
    Commit:     Caolán McNamara <caolanm@redhat.com>
    CommitDate: Thu Jan 8 20:58:51 2015 +0000
    
        asan: global-buffer-overflow on fdo55736-1.docx
    
        Change-Id: If69a57aa9ff011cc670f868cb87b3a1c4d904435

:040000 040000 9c7c5379e8f392bb6076fdfef9e3919386cb61e4 31dbba7551e24234c5ecb1da6356fec144bfde1a M      opt
----

- before that happened, the docx group shape simply had no children
- so, again, not really a regression, this never worked, just this problem was hidden by an other one
- how to fix this? the child shape is a ClosedBezierShape; we can write OpenBezierShape correctly
  - in the working case, DrawingML::WritePolyPolygon() is invoked, and it beginst an <a:custGeom/>
    - caller is ShapeExport::WritePolyPolygonShape()

=== 2016-12-02

https://bugs.documentfoundation.org/show_bug.cgi?id=104317

- confirm bibisect result from daily.git:
  - 2582dc5536e303c9f34d3b740914df759972fdf6 / 2016-06-17: source-hash-29e91d5eedd2bf20504ce9ada625d33fec19dc9e should be bad: indeed
  - c0512e5ea20f89a047edb75df2a55fb243b2998f / 2016-06-16: source-hash-3ab13873ebb6dc4738be2e2184ee4433a2447c1d should be good: indeed -> confirmed
- need minimal reproducer, probably the non-ASCII chars in the bugdoc are unrelated

=== 2016-12-16

https://bugs.documentfoundation.org/show_bug.cgi?id=104162

- it's unusual that rRowSeq[0][0] is an empty reference, but that was probably always like this
- can fix the regression by bailing out early in lcl_emptyRow() in that case

=== 2016-12-21

https://bugs.documentfoundation.org/show_bug.cgi?id=104744

- regression from 657c6cc3acec0528209a8584b838cd6de581c437
- spacing before the bullet: it's the "Before text" on the UI, 1.27cm -> 720 twips, but 0 in the bad case
- simply blacklisting NS_ooxml::LN_CT_Style_pPr in RTFSprms::cloneAndDeduplicate() is not an option, e.g. testParaBottomMargin in CppunitTest_sw_rtfimport shows it's needed

style has: LN_CT_Style_name, LN_CT_Style_pPr
para has: LN_CT_PPrBase_bidi, LN_CT_PPrBase_pStyle, LN_CT_PPrBase_ind, LN_CT_PPrBase_tabs

docx has this:
- style: ooxml:CT_Style_pPr (sprm) -> ooxml:CT_PPrBase_ind (sprm) -> ooxml:CT_Ind_left (attribute)
- paragraph: ooxml:CT_PPrBase_ind -> ooxml:CT_Ind_left

so what RTF does matches docx, but probably the style madness is too agressive

=== 2016-01-06

https://bugs.documentfoundation.org/show_bug.cgi?id=104150

- why does Word ignore <w:background>?
- recursive diff -> <w:displayBackgroundShape/> is present in settings.xml when Word respects the background color -> implemented the same

=== 2016-01-20

https://bugs.documentfoundation.org/show_bug.cgi?id=104334

Regression from d635b351849b8b576c907abf22500d0fa89ab54f

field code in the bugdoc is " STYLEREF 1 \s ", but \s isn't a documented parameter

" STYLEREF 1 \* MERGEFORMAT " is what we can handle correctly

=== 2017-01-27

https://bugs.documentfoundation.org/show_bug.cgi?id=103976

Reported: regression from 9e7eb63989ef1cf4b9a0e0404b84ef890db3d8e3 -- adds w:before/afterLines handling

there are no explicit paragraph settings -> table style TablewithHeaderinList1

zillion styles.xml entries like:

<w:spacing w:before="60" w:after="60" ...>

which one is relevant? from-scratch testcase:

- style:

 <w:spacing w:before="60" w:after="60" w:line="260" w:lineRule="exact"/>

- direct formatting:

 <w:spacing w:beforeLines="0" w:beforeAutospacing="0" w:afterLines="0" w:afterAutospacing="0" w:line="220" w:lineRule="exact"/>

Word's output: w:before/w:after has priority

(at least) 3 attributes: beforeAutospacing, beforeLines and before

=== 2017-02-03

https://bugs.documentfoundation.org/show_bug.cgi?id=104082

- regression, but seems to be fixed on master already
- 2016-11-14 is reported to be bad
- 2016-11-23 is where daily.git towards LO 5.4 starts -> indeed bad
- daily.git master is good -> can do reverse bibisect

daily.git:
- 35574763296c875a3a52ad1e2fd7dd3f9057ede8 is bad (good for g-b)
- master is good (bad for g-b)
- [8671898e81d6069d8b79c8c005158f813eaf21db] 2016-12-19: source-hash-5903235d57acb13d9d5286d23b443a01aeab9a3c is good (bad for g-b)
- [a990b0cfab53f3f73abdd5a6d44c377d61bbff0a] 2016-12-06: source-hash-8a460cfa1b1ce01c7a479ce2e7f21a92a2c50de3 is bad (good for g-b)
- [61bf95eee4de75fb69742384db9bf619a400215e] 2016-12-12: source-hash-634589b340316ba64b731b4d923c1056be415494 is good (bad for g-b)
- [1bd0403f0c5411496822fc2429d3a08f52d0a95e] 2016-12-09: source-hash-cb598029835477326b190bc99abd31a487cc5a91 is good (bad for g-b)
- [bc22f523978e3494c91fe5ceeba709c29e23ab49] 2016-12-08: source-hash-72b70d933e50edf95e989c59a69c396db06bd5e9 is bad (good for g-b)
- 1bd0403f0c5411496822fc2429d3a08f52d0a95e / 2016-12-09: source-hash-cb598029835477326b190bc99abd31a487cc5a91 is the first good (bad for g-b) -> indeed
- bc22f523978e3494c91fe5ceeba709c29e23ab49 / 2016-12-08: source-hash-72b70d933e50edf95e989c59a69c396db06bd5e9 is still bad -> indeed
- core.git range is 72b70d933e50edf95e989c59a69c396db06bd5e9..cb598029835477326b190bc99abd31a487cc5a91 -> fc8c4606e0834cd2128a228c2c95fc7c8f9eb7b1 is the fix, only need to backport it

second problem: 'xray ThisComponent' is broken on master

daily.git:
- 35574763296c875a3a52ad1e2fd7dd3f9057ede8 is good
- master is bad
- [8671898e81d6069d8b79c8c005158f813eaf21db] 2016-12-19: source-hash-5903235d57acb13d9d5286d23b443a01aeab9a3c is good
- [ddf2b9939e09c36a514378d28d2a4efb15e53e07] 2017-01-01: source-hash-879bac84cde2fc7cc27363d1bb0ca50c53162a88 is good
- [6ea6b077c7c4ca40f971a701989a1b5c577955ba] 2017-01-07: source-hash-0ad4b2570f06aa014f8446757931afa1f2305458 is good
- [9129d58b2bed1fa27b64b10a6f89a44ce16e1242] 2017-01-10: source-hash-4434b0029009d6d0327eaca1ff22a0c39711291d is bad
- [26f50489e12bc75025c79eda6bfd7d2ef2fa1072] 2017-01-09: source-hash-048e30c1f8231e6cd144a9251061f6fa127b353e is good
- 9129d58b2bed1fa27b64b10a6f89a44ce16e1242 / 2017-01-10: source-hash-4434b0029009d6d0327eaca1ff22a0c39711291d is the first bad
- 26f50489e12bc75025c79eda6bfd7d2ef2fa1072 / 2017-01-09: source-hash-048e30c1f8231e6cd144a9251061f6fa127b353e is the last good
- core.git range is 048e30c1f8231e6cd144a9251061f6fa127b353e..4434b0029009d6d0327eaca1ff22a0c39711291d -> reported as <https://bugs.documentfoundation.org/show_bug.cgi?id=105735>

third topic, to increase writerfilter test coverage.

----
oRules = ThisComponent.StyleFamilies.NumberingStyles.WWNum1.NumberingRules
xray oRules.getByIndex(0)(0) -> Adjust should be 2
----

before: rtfdispatchvalue.cxx line cov is 87.1%
after:  rtfdispatchvalue.cxx line cov is 87.4%

=== 2017-02-09

Brief research on the Rectangle -> tools::Rectangle rename.

- touch the relevant header
- make check COMPILER_EXTERNAL_TOOL=1 CCACHE_PREFIX=clang-rename-wrapper RENAME_ARGS="-qualified-name=Rectangle -new-name=tools::Rectangle"
- clang-apply-replacements -remove-change-desc-files /tmp/rename

need to fix up the header + the class itself, but all client code is adapted
correctly as far as I see -> promising. Bug for this is
<https://bugs.documentfoundation.org/show_bug.cgi?id=82580>.

in the modules which have their own foo::tools namespace, need to use ::tools::Rectangle:

----
for i in $(git grep -l '[^:]tools::Rectangle'); do sed -i 's/\([^:]\)tools::Rectangle/\1::tools::Rectangle/g' $i; done
for i in $(git grep -l '^tools::Rectangle'); do sed -i 's/^tools::Rectangle/::tools::Rectangle/g' $i; done
----

=== 2017-02-10

https://bugs.documentfoundation.org/show_bug.cgi?id=104039

- can't reproduce on master
- reported using 757a60d01dd152aadab2ba3c8224252481ce8a88 / 2016-11-14
- checked daily.git:
  - oldest is indeed bad
  - master is good -> can do reverse bibisect

daily.git reverse bibisect:
- [8671898e81d6069d8b79c8c005158f813eaf21db] 2016-12-19: source-hash-5903235d57acb13d9d5286d23b443a01aeab9a3c is good (bad for g-b)
- [a990b0cfab53f3f73abdd5a6d44c377d61bbff0a] 2016-12-06: source-hash-8a460cfa1b1ce01c7a479ce2e7f21a92a2c50de3 is good (bad for g-b)
- [9c47f8c7fcf2b64d14c00a617caa7fdb507111a2] 2016-11-29: source-hash-4130c8def811d1dcc87eacaa8ae48ba02738a790 is good (bad for g-b)
- [9d151bfa817a0d67179553a041c4e2a6ae16366a] 2016-11-26: source-hash-aabc5aab5af27e929a81a6036d2f470ab1f5ac4d is bad (good for g-b)
- [6ce98757cd7c024ff24b41fb33aec6c322eb030d] 2016-11-28: source-hash-2db42ab241d0852d89a470b18727c22d0fc06745 is bad (good for g-b)
- 9c47f8c7fcf2b64d14c00a617caa7fdb507111a2 / 2016-11-29: source-hash-4130c8def811d1dcc87eacaa8ae48ba02738a790 is the first good -> indeed
- 6ce98757cd7c024ff24b41fb33aec6c322eb030d / 2016-11-28: source-hash-2db42ab241d0852d89a470b18727c22d0fc06745 is the last bad -> indeed
- core.git range is 2db42ab241d0852d89a470b18727c22d0fc06745..4130c8def811d1dcc87eacaa8ae48ba02738a790 -> 787d31a94510ca3de9ce582d7b7402dfca584b23 looks related

lcov, rtfattributeoutput.cxx:
- old: line coverage is 77.8 %
- new: line coverage is 77.9 %

=== 2017-02-17

https://bugs.documentfoundation.org/show_bug.cgi?id=104081

- docx version works fine, probably missing import of a comat setting
- <w:doNotUseHTMLParagraphAutoSpacing/> perhaps this one? -> NS_ooxml::LN_CT_Compat_doNotUseHTMLParagraphAutoSpacing token -> \htmautsp in RTF

=== 2017-02-24

https://bugs.documentfoundation.org/show_bug.cgi?id=103931

QA says it's introduced by d185204737031955c56a24356ed003d342548434

problem seems to be that the last section in the bugdoc is empty, if it has 1 para, then we're OK.

dmapper debug xml simply has 2 vs 3 <DomainMapper.section> elements

bt for first section:

----
#0  0x00007fffc9e1c475 in writerfilter::dmapper::DomainMapper::lcl_startSectionGroup() (this=0x1ec10d0)
    at /home/vmiklos/git/libreoffice/master/writerfilter/source/dmapper/DomainMapper.cxx:2850
#1  0x00007fffc9e99561 in writerfilter::LoggedStream::startSectionGroup() (this=0x1ec10f8) at /home/vmiklos/git/libreoffice/master/writerfilter/source/dmapper/LoggedResources.cxx:96
#2  0x00007fffc9ef5aa4 in writerfilter::ooxml::OOXMLFastContextHandler::startSectionGroup() (this=this@entry=0x1eed340)
    at /home/vmiklos/git/libreoffice/master/writerfilter/source/ooxml/OOXMLFastContextHandler.cxx:436
#3  0x00007fffc9f51d3b in writerfilter::ooxml::OOXMLFactory_wml::startAction(writerfilter::ooxml::OOXMLFastContextHandler*) (this=<optimized out>, pHandler=0x1eed340)
    at /home/vmiklos/git/libreoffice/master/workdir/CustomTarget/writerfilter/source/ooxml/OOXMLFactory_wml.cxx:8084
----

bt for second section:

----
#0  0x00007fffc9e1c475 in writerfilter::dmapper::DomainMapper::lcl_startSectionGroup() (this=0x1ec0b70)
    at /home/vmiklos/git/libreoffice/master/writerfilter/source/dmapper/DomainMapper.cxx:2850
#1  0x00007fffc9e99561 in writerfilter::LoggedStream::startSectionGroup() (this=0x1ec0b98) at /home/vmiklos/git/libreoffice/master/writerfilter/source/dmapper/LoggedResources.cxx:96
#2  0x00007fffc9ef5b4b in writerfilter::ooxml::OOXMLFastContextHandler::startSectionGroup() (this=this@entry=0x1fb8190)
    at /home/vmiklos/git/libreoffice/master/writerfilter/source/ooxml/OOXMLFastContextHandler.cxx:437
#3  0x00007fffc9ef5e4e in writerfilter::ooxml::OOXMLFastContextHandler::handleLastParagraphInSection() (this=this@entry=0x1fb8190)
    at /home/vmiklos/git/libreoffice/master/writerfilter/source/ooxml/OOXMLFastContextHandler.cxx:576
#4  0x00007fffc9f51c6d in writerfilter::ooxml::OOXMLFactory_wml::startAction(writerfilter::ooxml::OOXMLFastContextHandler*) (this=<optimized out>, pHandler=0x1fb8190)
    at /home/vmiklos/git/libreoffice/master/workdir/CustomTarget/writerfilter/source/ooxml/OOXMLFactory_wml.cxx:8026
#5  0x00007fffc9ef3cc2 in writerfilter::ooxml::OOXMLFactory::startAction(writerfilter::ooxml::OOXMLFastContextHandler*, int) (pHandler=pHandler@entry=0x1fb8190)
    at /home/vmiklos/git/libreoffice/master/writerfilter/source/ooxml/OOXMLFactory.cxx:163
#6  0x00007fffc9ef46ba in writerfilter::ooxml::OOXMLFastContextHandler::lcl_startFastElement(int, com::sun::star::uno::Reference<com::sun::star::xml::sax::XFastAttributeList> const&) (this=0x1fb8190, Element=921300) at /home/vmiklos/git/libreoffice/master/writerfilter/source/ooxml/OOXMLFastContextHandler.cxx:197
#7  0x00007fffc9ef9bf0 in writerfilter::ooxml::OOXMLFastContextHandler::startFastElement(int, com::sun::star::uno::Reference<com::sun::star::xml::sax::XFastAttributeList> const&) (this=0x1fb8190, Element=921300, Attribs=uno::Reference to (sax_fastparser::FastAttributeList *) 0x1f7a178)
    at /home/vmiklos/git/libreoffice/master/writerfilter/source/ooxml/OOXMLFastContextHandler.cxx:168
----

testcase: xray ThisComponent.TextSections.getCount ' should be 3

=== 2017-03-03

https://bugs.documentfoundation.org/show_bug.cgi?id=104287

Given picture wrapped in a shape can't be imported anymore inside table.

- pict itself is there if buffer is disabled during buffer replay to avoid recursion
- size is still wrong

bad size:

          <GraphicImport.sprm name="ooxml:CT_Anchor_extent">RTFSprm ('ooxml:CT_Anchor_extent', '0')
            <GraphicImport.attribute name="ooxml:CT_PositiveSize2D_cx" value="0"/>
            <GraphicImport.attribute name="ooxml:CT_PositiveSize2D_cy" value="0"/>
          </GraphicImport.sprm>

good size:

          <GraphicImport.sprm name="ooxml:CT_Anchor_extent">RTFSprm ('ooxml:CT_Anchor_extent', '0')
            <GraphicImport.attribute name="ooxml:CT_PositiveSize2D_cx" value="6050160"/>
            <GraphicImport.attribute name="ooxml:CT_PositiveSize2D_cy" value="4020840"/>
          </GraphicImport.sprm>

unrelated: XMLEncryptionTemplateImpl is unused in xmlsecurity, since 0649622956431e0a1955cb80d1175025401ab5e5

=== 2017-03-10

https://bugs.documentfoundation.org/show_bug.cgi?id=105729

- minimized bugdoc is fine, what is the difference between the minimal and the full bugdoc?
- \ltrpar is the key for some reason, just removing those from the orig bugdoc fixes the lack of center
- \qc is NS_ooxml::LN_Value_ST_Jc_center (type is NS_ooxml::LN_CT_PPrBase_jc)
- LN_CT_PPrBase_jc is found to be a duplicate; but that should be fine.
- this situation is similar to 92fd894ea18672cba4cf961bdc4c0bc98f168102, but here \qc comes from a style
- ww8 import equivalent is SwWW8ImplReader::Read_ParaBiDi(), it does not set the paragraph adjustment
- this docx import behavior was added by 2638faa2e834c2da4c195224fd88d32c29b3d0cc

=== 2017-03-17

https://bugs.documentfoundation.org/show_bug.cgi?id=106492

doc model is:

----
[   0] 0x1c2bcb0            StartNode , 
[   1] 0x1c30310              EndNode , 
[   2] 0x1c2c930            StartNode , 
[   3] 0x1c35040              EndNode , 
[   4] 0x1c2de40            StartNode , 
[   5] 0x1c32990              EndNode , 
[   6] 0x1c2dd80            StartNode , 
[   7] 0x1c2b960              EndNode , 
[   8] 0x1c23910            StartNode , 
[   9]  0x1c5def0            TextNode "", 
[  10]  0x1f86970         SectionNode , 
[  11]   0x1f60d60           TextNode "", 
[  12]  0x1f77d30             EndNode , 
[  13]  0x1f9dbb0         SectionNode , 
[  14]   0x1f713b0           TextNode "", 
[  15]  0x1f6ba70             EndNode , 
[  16] 0x1c289f0              EndNode }
----

3 sections with no additional para:

----
[   0] 0x1beedc0            StartNode , 
[   1] 0x1be4b30              EndNode , 
[   2] 0x1beb910            StartNode , 
[   3] 0x1bf6fd0              EndNode , 
[   4] 0x1c0e530            StartNode , 
[   5] 0x1bf76b0              EndNode , 
[   6] 0x1bf76f0            StartNode , 
[   7] 0x1c0e400              EndNode , 
[   8] 0x1c0e440            StartNode , 
[   9]  0x1d2e0a0         SectionNode , 
[  10]   0x1c29750           TextNode "", 
[  11]  0x1d2eed0             EndNode , 
[  12]  0x1d2dc40         SectionNode , 
[  13]   0x1d7e740           TextNode "", 
[  14]  0x1d7fb10             EndNode , 
[  15]  0x1d90700         SectionNode , 
[  16]   0x1d908a0           TextNode "", 
[  17]  0x1df1ca0             EndNode , 
[  18] 0x1c0ed10              EndNode }
----

3 sections + one additional para:

----
[   0] 0x1be7840            StartNode , 
[   1] 0x1bff840              EndNode , 
[   2] 0x1bece70            StartNode , 
[   3] 0x1bedc40              EndNode , 
[   4] 0x1bf95c0            StartNode , 
[   5] 0x1bf8610              EndNode , 
[   6] 0x1c0e510            StartNode , 
[   7] 0x1c0e3a0              EndNode , 
[   8] 0x1bff740            StartNode , 
[   9]  0x1d2dc20         SectionNode , 
[  10]   0x1c29680           TextNode "", 
[  11]  0x1d1baf0             EndNode , 
[  12]  0x1d2ea90         SectionNode , 
[  13]   0x1d1d8c0           TextNode "", 
[  14]  0x1def500             EndNode , 
[  15]  0x1d6ce20         SectionNode , 
[  16]   0x1d6cfc0           TextNode "", 
[  17]  0x1df1be0             EndNode , 
[  18]  0x1d6d7c0            TextNode "", 
[  19] 0x1c0ec70              EndNode }
----

=== 2017-03-24

https://bugs.documentfoundation.org/show_bug.cgi?id=106694

dmapper has code to deduplicate tabs, is that still necessary? see commit 7f6e26917d -> yes, necessary

ooxml:CT_PPrBase_tabs / 92158 is the token in question, should not dedup it in this case probably

=== 2017-03-25

kerning broken for docx import?

doc bt:

----
#0  0x00007fffcbccf334 in SwDoc::RemoveAllFormatLanguageDependencies() (this=0x1c04070) at /home/vmiklos/git/libreoffice/master/sw/source/core/doc/poolfmt.cxx:333
#1  0x00007fffcc2bc92b in SwDocShell::ConvertFrom(SfxMedium&) (this=0x1bdbdc0, rMedium=...) at /home/vmiklos/git/libreoffice/master/sw/source/uibase/app/docsh.cxx:256
#2  0x00007ffff288f13f in SfxObjectShell::DoLoad(SfxMedium*) (this=0x1bdbdc0, pMed=pMed@entry=0x1bf25f0) at /home/vmiklos/git/libreoffice/master/sfx2/source/doc/objstor.cxx:776
#3  0x00007ffff28b6647 in SfxBaseModel::load(com::sun::star::uno::Sequence<com::sun::star::beans::PropertyValue> const&) (this=0x1bdc880, seqArguments=...)
    at /home/vmiklos/git/libreoffice/master/sfx2/source/doc/sfxbasemodel.cxx:1802
----

-> CharAutoKerning

=== 2017-03-31

https://bugs.documentfoundation.org/show_bug.cgi?id=106690

a situation where auto spacing is supposed to mean something...

regression from c486e875de7c8e845594f5043a37ee8800865782

=== 2017-04-07

https://bugs.documentfoundation.org/show_bug.cgi?id=106970

one more fallout from the numbering vs autospace thing

regression from c486e875de7c8e845594f5043a37ee8800865782

ww8 equivalent code is SwWW8ImplReader::AppendTextNode

additional condition: only collapse autospace if NumberingStyleName is the same -> fixed

sigh, xray is broken again on master -- but 2017-03-17 is fine -> need to get back to this later

<<<

Problematic bugs:

https://bugs.documentfoundation.org/show_bug.cgi?id=104556 "FILEOPEN DOCX: Misplaced vertical red line (drawing object)" -- gave it a try, no luck so far

// vim: ft=asciidoc
