= LO hacking notes

== 2011-12-22

- cmdline to incrementally rebuild with debug:

----
make -sr dbglevel=2 -j4
----

- cmdline to get SAL_INFO / SAL_WARN output:

----
SAL_LOG=+INFO.writerfilter+WARN.writerfilter ./soffice.bin --nologo /home/vmiklos/git/libreoffice/lo-test-files/writer/bugs/fdo40937/Crashing.rtf 2>&1 |tee out
----

== 2011-12-28

typical konsole tabs:

- doc
- build
- hack
- run
- test
- push

onegit master build with empty ccache but ccache enabled on my t520:

----
real    93m35.371s
----

with full ccache:

----
real    26m24.653s
----

== 2012-01-01

Export filter -> exporter calls:

- doc: SwWW8Writer::WriteStorage
- docx: DocxExportFilter::exportDocument
- rtf: RtfExportFilter::filter

== 2012-01-11

Localized string howto: add the string to src/hrc, then:

----
#include <tools/resmgr.hxx>
#include <vcl/svapp.hxx>
... include of the hrc ...

static ResMgr* pResMgr = ResMgr::CreateResMgr("module", Application::GetSettings().GetUILocale());
OUString sFooBar(ResId::toString(ResId(RID_MODULESTR_FOO_BAR, *pResMgr)));
----

== 2011-02-04

bibisect:

SAL_USE_VCLPLUGIN="gen" opt/program/soffice.bin

good: 65fd30f5cb4cdd37995a33420ed8273c0a29bf00
bad: 4c30602f43475389f81b1d981ce8ee9a3410b9d9

-> d5f5b9bb5dc47417fcd9cc494b8d2dcd4a7c620e first bad -> a57304a53832adf0c8a32b0c53d9be5b55507ab1 in core.git
-> d0ae9578f865b45dd01b822d5d6be45b5872f842 last good -> 97453f1eabb473d0691e41153eff2ac92e88a302 in core.git

== 2011-03-28

To run a single unit test in gdb:

----
GDBCPPUNITTRACE="gdb --args" make -sr dbglevel=2 /home/vmiklos/git/libreoffice/master/workdir/unxlngx6.pro/CppunitTest/sw_subsequent_ooxmltok.test
----

== 2011-03-29

Installing all build-deps on openSUSE:

----
zypper in libreoffice-sdk # this will pull in openjdk instead of gcj
zypper si -d libreoffice
zypper in doxygen ctags
----

== 2011-04-03

Magic line to load http://bernard.marcelly.perso.sfr.fr/index2.html[xray] when it's already installed:

----
GlobalScope.BasicLibraries.LoadLibrary("XrayTool")
----

== 2011-04-04

- samples to insert set / get fields:

----
Sub insertSetField()
oDoc = ThisComponent 
oMasters = oDoc.TextFieldMasters
sMasterFieldName = "com.sun.star.text.FieldMaster.SetExpression.foo"
if oMasters.hasByName(sMasterFieldName) then
    oMaster = oMasters.getByName(sMasterFieldName)
else
    oMaster = oDoc.createInstance("com.sun.star.text.FieldMaster.SetExpression")
    oMaster.Name = "foo"
    oMaster.SubType = 3
end if
oField = oDoc.createInstance("com.sun.star.text.TextField.SetExpression") 
oField.Content = "bar"
oField.attachTextFieldMaster(oMaster)
oField.SubType = 3
oField.IsVisible = False
oText = oDoc.Text 
oCurs = oDoc.getCurrentController().getViewCursor()
oText.insertTextContent(oCurs, oField, False) 
End Sub

Sub insertGetField()
oDoc = ThisComponent 
oField = oDoc.createInstance("com.sun.star.text.TextField.GetExpression") 
oField.Content = "foo"
oField.SubType = 3
oText = oDoc.Text 
oCurs = oDoc.getCurrentController().getViewCursor()
oText.insertTextContent(oCurs, oField, False) 
End Sub
----

== 2012-05-05

Experimenting with gdb pretty-printers:

To run once:

----
gdb --args ./soffice.bin --nologo /home/vmiklos/git/libreoffice/master/sw/qa/extras/ooxmltok/data/n751017.docx
b DomainMapper_Impl.cxx:3093
print xFieldProperties
----

To reload without restart:

----
python import libreoffice.cppu
python p = libreoffice.cppu.BeansXPropertySetPrinter("com::sun::star::beans::XPropertySet", gdb.parse_and_eval("*xFieldProperties.get()")); print p.to_string()
python reload(libreoffice.cppu)
----

The XPropretySet pretty-printer is blocked by this: http://sourceware.org/bugzilla/show_bug.cgi?id=13326

== 2012-06-25

How to trigger SwXTextDefaults::supportsService() from basic:

----
o = ThisComponent.createInstance("com.sun.star.text.Defaults")
xray o.supportsService("com.sun.star.style.CharacterProperties")
----

== 2012-07-21

Simple Calc macro:

----
' Does the following transformation:
' A1: 11, B1: 11, A2: 11, B2: 11 -> A1: 11, B1: 12, A2: 13, B2: 14
' Works if starting point is not A1, or prefix is not "1"
contents = ThisComponent.CurrentSelection.String
contents = left(contents, len(contents)-1)
document   = ThisComponent.CurrentController.Frame
dispatcher = createUnoService("com.sun.star.frame.DispatchHelper")
dim args(0) as new com.sun.star.beans.PropertyValue
dispatcher.executeDispatch(document, ".uno:GoRight", "", 0, args())
ThisComponent.CurrentSelection.String = contents & "2"
dispatcher.executeDispatch(document, ".uno:GoLeft", "", 0, args())
dispatcher.executeDispatch(document, ".uno:GoDown", "", 0, args())
ThisComponent.CurrentSelection.String = contents & "3"
dispatcher.executeDispatch(document, ".uno:GoRight", "", 0, args())
ThisComponent.CurrentSelection.String = contents & "4"
dispatcher.executeDispatch(document, ".uno:GoLeft", "", 0, args())
dispatcher.executeDispatch(document, ".uno:GoUp", "", 0, args())
----
