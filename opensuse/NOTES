= openSUSE notes

== osc

- Updating a package in OBS, examples:

----
osc build --alternative-project openSUSE:Leap:42.2 --release 9999 standard
osc build openSUSE_13.2
osc build --alternative-project=openSUSE:13.2 ports (ARM)
----

then:

----
osc vc
osc commit
----

- Updating its git mirror:

cd $HOME/git/opensuse-packages
git checkout gtimelog
$HOME/git/bsgit/bsgit.py fetch home:vmiklos/gtimelog
git merge remotes/api.opensuse.org/home/vmiklos/gtimelog
git push origin

== zypper

- zypper factory bootstrap:

zypper --root /var/chroot/opensuse-factory addrepo http://download.opensuse.org/factory/repo/oss/ repo-oss
zypper --root /var/chroot/opensuse-factory install patterns-openSUSE-base

- zyp-file: https://github.com/benthaman/zyp-file

- downgrade after broken update: zypper in --oldpackage --from repo-oss pkg1 [ pkg2 ... ]

- upgrade to some package from a custom repo:

zypper -p http://download.opensuse.org/repositories/KDE:/Extra/openSUSE_13.1/ in gtk2-engine-oxygen-1.4.4-11.1.x86_64 gtk2-theme-oxygen-1.4.4-11.1.x86_64

== cubox-i

- attach screen:

screen /dev/ttyUSB0 115200

- re-generate boot.scr (in /boot):

mkimage -C none -A arm -T script -d boot.script boot.scr

- raid1 root:

edit /etc/dracut.conf.d/01-dist.conf, comment out hostonly=

- special dracut problem because the kernel version ends with "-i", just run:

dracut --force

without any parameters, and it'll work.

== Upgrade notes

=== openSUSE 13.1 -> 13.2

- virt-manager is broken by default

https://bugzilla.suse.com/show_bug.cgi?id=901869

TL;DR: zypper in typelib-1_0-Gtk-3_0 typelib-1_0-SpiceClientGtk-3_0 typelib-1_0-GtkVnc-2_0

- STL container pretty-printers do not work by default in gdb anymore (debuginfo uninstalled on upgrade?):

Can be fixed with: 'zypper in libstdc++6-debuginfo'

- virt-resize is broken by default

https://bugzilla.novell.com/show_bug.cgi?id=908632

TL;DR: zypper -p http://download.opensuse.org/repositories/Virtualization/openSUSE_13.2/ in guestfs-data-1.26.9-163.1.x86_64

=== openSUSE 13.2 -> openSUSE Leap 42.1

- adjust repos:

  * 13.2 -> Leap-13.2 in names
  * 13.2 -> leap/42.1 in URLs

- cpm fails to build

https://bugzilla.novell.com/show_bug.cgi?id=918553

Fixed in <24 hours. :-)

- cxoffice is broken

https://bugzilla.novell.com/show_bug.cgi?id=845916

Fix: cd /opt/cxoffice/lib; mkdir t; mv libxcb* t

- KDE4 -> KDE5, retain a number of old settings:

  * update /etc/sysconfig/displaymanager: kdm -> sddm
  * cursor theme: Get New Theme, DMZ
  * desktop effects: change virtual desktop switching animation from slide to fade
  * panel height: 35px, clock date
  * digital clock settings -> tick 'show week numbers in Calendar'
  * k menu: alternatives -> launcher is the kde4 style thing
  * k menu favorites: systemsettings -> systemsettings5, etc
  * kbd layout chooser in systemsettings5
  * kbd layout fix: alt-1 and alt-7 works in bash once global keyboard shortcuts 'walk through windows of current application' (alt-~ and alt-`) are disabled
  * disable screen lock on screensaver
  * focus follows mouse: window management -> window behavior -> focus
  * kmix: individual process control seems to be no longer implemented, using 'pavucontrol' is a workaround

- sidebar is broken in mutt:

https://build.opensuse.org/request/show/350312
https://build.opensuse.org/request/show/353183

- STL container pretty-printers do not work by default in gdb anymore:

Can be fixed with: 'zypper in libstdc++6-devel-gcc5'

- (not really specific to this upgrade): SSD freezes the system from time to time:

libata.force=noncq kernel param seems to improve the situation. More info:

http://www.howtoeverything.net/linux/hardware/ubuntu-freeze-issue-after-ssd-upgrade

=== openSUSE 42.1 -> openSUSE Leap 42.2

- adjust repos trivially (42.1 -> 42.2)
- mutt again prints "NBOX" for "INBOX"
  - minimal fix is to build server:mail/mutt r114 from OBS, that's new enough
    to be fixed, but old enough to be fully backwards-compatible; rpm is at
    <https://people.freedesktop.org/~vmiklos/2016/mutt-1.5.24-9999.x86_64.rpm>

=== openSUSE 13.2 -> openSUSE Leap 42.2 for ARMV7

- images: http://download.opensuse.org/ports/armv7hl/distribution/leap/42.2/appliances/
  - openSUSE-Leap42.2-ARM-JeOS-cuboxi.armv7l-2016.11.25-Build1.8.raw.xz is what I used
- boot from raid1, still need to change:
  - /boot/boot.script, add RAID1 UUIDs + run mkimage
  - /etc/dracut.conf.d/01-dist.conf:
    - copy from /usr, comment out hostonly=
    - also 'add_drivers+="ci_hdrc_imx"' is needed for some reason to see the USB raid1 HDDs + run dracut

=== openSUSE 42.2 -> openSUSE Leap 42.3

- mutt is replaced by neomutt, minor tweaks to config is necessary: https://github.com/vmiklos/dotfiles/commit/ac3dd6b0989527131c8bccd8602463aac3b05b33
  - gets rid of "unknown config key" error on startup + number of unread mails are shown again on the sidebar
- gcontacts is broken: need to install the python-oauth2client package
  - this used to be provided by the google-api-python-client package, which gets removed during upgrade
- colors in vim are strange: actually a konsole problem
  - settings -> edit current profile -> general -> environment -> edit -> TERM should be 'xterm', not 'xterm-256color'
- usual pain with firefox and html5 codecs: https://en.opensuse.org/SDB:Firefox_MP4/H.264_Video_Support
  - installing the mentioned packages from packman fixes the problem

- KDE5 restart:

----
killall plasmashell #to stop it
kstart plasmashell #to restart it
----

// vim: ft=asciidoc paste
