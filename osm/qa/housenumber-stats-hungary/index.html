<!doctype html>
<html>
<head>
	<!--
	 Source code:
	 https://github.com/vmiklos/vmexam/tree/master/osm/qa/housenumber-stats-hungary
	-->
	<title>Housenumber stats: Hungary</title>
	<script src="Chart.min.js"></script>
	<script src="chartjs-plugin-datalabels.min.js"></script>
	<script src="jquery.min.js"></script>
	<style>

div.canvasblock {
    width: 75%;
    margin: auto;
    margin-top: 5px;
    margin-bottom: 5px;
    border: 1px solid #7f7f7f;
    padding: 5px;
}
	</style>
	<meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body>
    <h1>Housenumber stats: Hungary</h1>
    <h2 id="_daily">New house numbers</h2>
    <div class="canvasblock">
        <canvas id="daily"></canvas>
    </div>
    <h2 id="_topusers">Top house number editors</h2>
    <div class="canvasblock">
        <canvas id="topusers"></canvas>
    </div>
    <h2 id="_progress">Coverage</h2>
    <div class="canvasblock">
        <canvas id="progress"></canvas>
    </div>
    <script>
var statsJSON = "/osm/housenumber-stats/hungary/stats.json";
$.getJSON(statsJSON, function(stats) {
    var daily = stats.daily;
    var topusers = stats.topusers;
    var progress = stats.progress;

    var dailyData = {
        // daily is a list of label-data pairs.
        labels: daily.map(x => x[0]),
        datasets: [{
            backgroundColor: "rgba(0, 255, 0, 0.5)",
            data: daily.map(x => x[1]),
        }]

    };
    var ctx = document.getElementById('daily').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: dailyData,
        options: {
            title: {
                display: true,
                text: "New house numbers, last 5 days, as of " + progress.date,
            },
            scales: {
                xAxes: [{
                    ticks: { suggestedMin: 0, },
                    scaleLabel: {
                        display: true,
                        labelString: "Time"
                    },
                }],
                yAxes: [{
                    scaleLabel: {
                        display: true,
                        labelString: "New house numbers"
                    },
                }]
            },
            plugins: {
                datalabels: {
                    align: 'top',
                    anchor: 'end',
                }
            },
            tooltips: {
                enabled: false,
            },
            legend: {
                display: false,
            },
        }
    });

    var topusersData = {
        // topusers is a list of label-data pairs.
        labels: topusers.map(x => x[0]),
        datasets: [{
            backgroundColor: "rgba(0, 255, 0, 0.5)",
            data: topusers.map(x => x[1]),
        }]

    };
    var ctx = document.getElementById('topusers').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: topusersData,
        options: {
            title: {
                display: true,
                text: "Top house number editors, as of " + progress.date,
            },
            scales: {
                xAxes: [{
                    ticks: { suggestedMin: 0, },
                    scaleLabel: {
                        display: true,
                        labelString: "User name"
                    },
                }],
                yAxes: [{
                    scaleLabel: {
                        display: true,
                        labelString: "Number of house numbers last changed by this user",
                    },
                }]
            },
            plugins: {
                datalabels: {
                    align: 'top',
                    anchor: 'end',
                }
            },
            tooltips: {
                enabled: false,
            },
            legend: {
                display: false,
            },
        }
    });

    var progressData = {
        datasets: [{
            label: 'Reference',
            backgroundColor: "rgba(255, 0, 0, 0.5)",
            data: [ progress.reference ],
        }, {
            label: 'OSM',
            backgroundColor: "rgba(0, 255, 0, 0.5)",
            data: [ progress.osm ],
        }]

    };
    var ctx = document.getElementById('progress').getContext('2d');
    new Chart(ctx, {
        type: 'horizontalBar',
        data: progressData,
        options: {
            title: {
                display: true,
                text: "Coverage is " + progress.percentage + "%, as of " + progress.date,
            },
            scales: {
                xAxes: [{
                    ticks: { min: 0.0, },
                    scaleLabel: {
                        display: true,
                        labelString: "Number of house numbers in database",
                    },
                }]
            },
            plugins: {
                datalabels: {
                    formatter: function(value, context) {
                        // Turn 1000 into '1 000'.
                        return value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ")
                    }
                }
            },
            tooltips: {
                enabled: false,
            }
        }
    });
});
	</script>
</body>
</html>
