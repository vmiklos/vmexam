#!/bin/bash -e

#
# example ~/.curlrc.gcalsync (use firebug to get the exact cookie/form
# values):
#
# user-agent = "Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.2) Gecko/20100125 Firefox/3.6"
# referer = "https://www.google.com/calendar/hosted/domain.com/render"
# cookie = "S=foo; secid=bar"
# form = "filename=@items.ics"
# form = "src=baz"
# url = "https://www.google.com/calendar/hosted/domain.com/upload_event"

echo "creating items.ics..."
echo -e 'yes\nno' |gammu --backup items.ics
dos2unix items.ics
sed -i '/DTSTART/s/Z$//' items.ics
sed -i '/DTEND/s/Z$//' items.ics
sed -i '/ALARM/s/Z$//' items.ics
unix2dos items.ics
echo "uploading events..."
curl -s -k --config ~/.curlrc.gcalsync |elinks -dump \
	|iconv -f utf8 -t $(locale -a |grep $LC_ALL|grep -m1 '\.'|sed "s/$LC_ALL.//")
rm -f items.ics
echo "done."
